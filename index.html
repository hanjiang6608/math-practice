<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="format-detection" content="telephone=no">
    <meta name="description" content="å°å­¦ä¸‰å¹´çº§æ•°å­¦æ™ºèƒ½ç»ƒä¹ ç³»ç»Ÿ - å¾®ä¿¡H5">
    <meta name="keywords" content="å°å­¦æ•°å­¦,æ•°å­¦ç»ƒä¹ ,ä¸‰å¹´çº§æ•°å­¦,å£ç®—ç»ƒä¹ ">
    
    <!-- å¾®ä¿¡åˆ†äº«é…ç½® -->
    <meta property="og:title" content="ğŸ“ å°å­¦ä¸‰å¹´çº§æ•°å­¦ç»ƒä¹ ">
    <meta property="og:description" content="æ™ºèƒ½å‡ºé¢˜ï¼Œè‡ªåŠ¨åˆ†æè–„å¼±ç‚¹ï¼Œè®©æ•°å­¦å­¦ä¹ æ›´é«˜æ•ˆï¼">
    <meta property="og:image" content="https://via.placeholder.com/300x300/667eea/ffffff?text=æ•°å­¦ç»ƒä¹ ">
    
    <!-- ç¦æ­¢ç¼“å­˜ï¼ˆå¼€å‘é˜¶æ®µï¼‰ -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    
    <title>ğŸ“ ä¸‰å¹´çº§æ•°å­¦ç»ƒä¹ </title>
    
    <!-- GitHub Pages åŸºç¡€è·¯å¾„è®¾ç½® -->
    <base href="https://hanjiang6608.github.io/math-practice/">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'Helvetica Neue', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            min-height: 100dvh;
            padding: 2px;
            padding-bottom: env(safe-area-inset-bottom);
            -webkit-font-smoothing: antialiased;
        }
        
        .container {
            max-width: 480px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
            min-height: calc(100vh - 4px);
            min-height: calc(100dvh - 4px);
            display: flex;
            flex-direction: column;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 6px;
            text-align: center;
            position: relative;
        }

        .header h1 {
            font-size: 16px;
            margin-bottom: 2px;
            font-weight: 600;
        }

        .header .subtitle {
            font-size: 10px;
            opacity: 0.9;
        }
        
        .share-btn {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 10px;
            cursor: pointer;
        }
        
        .nav-tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
            flex-shrink: 0;
        }
        
        .nav-tab {
            flex: 1;
            padding: 8px 8px;
            text-align: center;
            font-size: 13px;
            color: #6c757d;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
            background: transparent;
            font-weight: 500;
        }
        
        .nav-tab.active {
            color: #667eea;
            font-weight: 600;
            background: white;
            position: relative;
        }
        
        .nav-tab.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 20%;
            right: 20%;
            height: 3px;
            background: #667eea;
            border-radius: 3px 3px 0 0;
        }
        
        .content {
            flex: 1;
            padding: 6px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .page {
            display: none;
            height: 100%;
        }
        
        .page.active {
            display: block;
        }
        
        /* ç»ƒä¹ é¡µé¢æ ·å¼ */
        
        /* ğŸ® æ¸¸æˆåŒ–ä¿¡æ¯æ  */
        .game-stats {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 8px;
            padding: 6px 8px;
            margin-bottom: 6px;
            color: white;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }

        .level-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 4px;
        }

        .level-badge {
            background: rgba(255,255,255,0.2);
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: 700;
        }

        .title-badge {
            background: rgba(255,255,255,0.25);
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: 600;
        }

        .score-info {
            text-align: center;
            margin-bottom: 4px;
        }

        .score-display {
            font-size: 13px;
            font-weight: 700;
        }

        .exp-bar-container {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .exp-bar {
            flex: 1;
            height: 5px;
            background: rgba(255,255,255,0.2);
            border-radius: 3px;
            overflow: hidden;
        }

        .exp-fill {
            height: 100%;
            background: linear-gradient(90deg, #ffd43b, #fcc419);
            border-radius: 3px;
            transition: width 0.5s ease;
        }

        .exp-text {
            font-size: 9px;
            min-width: 40px;
            text-align: right;
        }
        
        .stats-bar {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 4px;
            margin-bottom: 6px;
            padding: 5px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 6px;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-value {
            font-size: 16px;
            font-weight: 700;
            color: #667eea;
            line-height: 1;
        }

        .stat-label {
            font-size: 9px;
            color: #6c757d;
            margin-top: 2px;
        }
        
        .difficulty-selector {
            margin-bottom: 6px;
        }

        .difficulty-selector label {
            display: block;
            margin-bottom: 4px;
            font-size: 11px;
            color: #495057;
            font-weight: 500;
        }

        .difficulty-btns {
            display: flex;
            gap: 6px;
        }

        .difficulty-btn {
            flex: 1;
            padding: 5px;
            border: 2px solid #e9ecef;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
            font-weight: 500;
        }
        
        .difficulty-btn.active {
            border-color: #667eea;
            background: #667eea;
            color: white;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
        
        .question-card {
            background: #fff;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 8px 10px;
            text-align: center;
            margin-bottom: 6px;
            transition: all 0.3s ease;
        }
        
        .question-card.correct {
            border-color: #28a745;
            background: #d4edda;
            animation: correctPulse 0.5s ease;
        }
        
        .question-card.wrong {
            border-color: #dc3545;
            background: #f8d7da;
            animation: shake 0.5s ease;
        }
        
        @keyframes correctPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        .question-text {
            font-size: 26px;
            font-weight: 700;
            color: #212529;
            margin-bottom: 8px;
            font-family: 'Courier New', monospace;
        }
        
        .answer-input {
            width: 100%;
            padding: 6px;
            font-size: 20px;
            text-align: center;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            outline: none;
            transition: all 0.3s;
            background: #f8f9fa;
            font-weight: 600;
            color: #495057;
            letter-spacing: 2px;
        }
        
        .answer-input:focus {
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
        }
        
        .btn {
            width: 100%;
            padding: 8px;
            font-size: 14px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            -webkit-tap-highlight-color: rgba(0,0,0,0.1);
        }
        
        .btn:active {
            transform: scale(0.98);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn-primary:active {
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
            margin-top: 10px;
        }
        
        .btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }
        
        .feedback {
            margin-top: 4px;
            padding: 5px;
            border-radius: 6px;
            text-align: center;
            font-size: 12px;
            display: none;
            font-weight: 500;
        }
        
        .feedback.show {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .feedback.success {
            background: #d4edda;
            color: #155724;
        }
        
        .feedback.error {
            background: #f8d7da;
            color: #721c24;
        }
        
        /* æ•°å­—é”®ç›˜ */
        .number-pad {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 15px;
        }
        
        .num-btn {
            padding: 18px;
            font-size: 24px;
            border: none;
            background: #f8f9fa;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.15s;
            font-weight: 600;
            color: #495057;
            -webkit-tap-highlight-color: rgba(0,0,0,0.1);
        }
        
        .num-btn:active {
            background: #667eea;
            color: white;
            transform: scale(0.95);
        }
        
        .num-btn.clear {
            background: #ff6b6b;
            color: white;
        }
        
        .num-btn.clear:active {
            background: #ee5a5a;
        }
        
        .num-btn.submit {
            background: #51cf66;
            color: white;
        }
        
        .num-btn.submit:active {
            background: #40c057;
        }
        
        /* å†å²è®°å½•é¡µé¢æ ·å¼ */
        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .history-header h2 {
            font-size: 17px;
            color: #212529;
            font-weight: 600;
        }
        
        .clear-btn {
            padding: 8px 14px;
            font-size: 12px;
            background: #ff6b6b;
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        .clear-btn:active {
            background: #ee5a5a;
            transform: scale(0.95);
        }
        
        .summary-cards {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .summary-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 15px;
            border-radius: 12px;
            text-align: center;
        }
        
        .summary-card .number {
            font-size: 26px;
            font-weight: 700;
            color: #667eea;
        }
        
        .summary-card .label {
            font-size: 12px;
            color: #6c757d;
            margin-top: 4px;
            font-weight: 500;
        }
        
        .history-list {
            max-height: calc(100vh - 350px);
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            padding-right: 5px;
        }
        
        .history-list::-webkit-scrollbar {
            width: 4px;
        }
        
        .history-list::-webkit-scrollbar-thumb {
            background: #dee2e6;
            border-radius: 2px;
        }
        
        .history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            border-bottom: 1px solid #f1f3f5;
            background: white;
            transition: background 0.2s;
        }
        
        .history-item:active {
            background: #f8f9fa;
        }
        
        .history-item:last-child {
            border-bottom: none;
        }
        
        .history-question {
            font-size: 16px;
            font-weight: 600;
            color: #212529;
            font-family: 'Courier New', monospace;
        }
        
        .history-result {
            text-align: right;
        }
        
        .history-answer {
            font-size: 13px;
            color: #6c757d;
            margin-bottom: 3px;
        }
        
        .history-status {
            font-size: 11px;
            font-weight: 600;
            padding: 3px 10px;
            border-radius: 20px;
            display: inline-block;
        }
        
        .history-status.correct {
            background: #d3f9d8;
            color: #2b8a3e;
        }
        
        .history-status.wrong {
            background: #ffe3e3;
            color: #c92a2a;
        }
        
        .history-time {
            font-size: 10px;
            color: #adb5bd;
            margin-top: 3px;
        }
        
        /* é”™é¢˜ç»Ÿè®¡é¡µé¢æ ·å¼ */
        .weakness-header {
            margin-bottom: 15px;
        }
        
        .weakness-header h2 {
            font-size: 17px;
            color: #212529;
            margin-bottom: 5px;
            font-weight: 600;
        }
        
        .weakness-header p {
            font-size: 12px;
            color: #6c757d;
            line-height: 1.5;
        }
        
        .weakness-chart {
            margin-bottom: 15px;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 12px;
        }
        
        .weakness-item {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .weakness-item:last-child {
            margin-bottom: 0;
        }
        
        .weakness-label {
            width: 50px;
            font-size: 14px;
            color: #495057;
            font-weight: 500;
        }
        
        .weakness-bar {
            flex: 1;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 0 10px;
        }
        
        .weakness-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s ease;
            position: relative;
        }
        
        .weakness-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, rgba(255,255,255,0) 0%, rgba(255,255,255,0.3) 50%, rgba(255,255,255,0) 100%);
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        .weakness-fill.high {
            background: linear-gradient(90deg, #ff6b6b, #fa5252);
        }
        
        .weakness-fill.medium {
            background: linear-gradient(90deg, #ffd43b, #fab005);
        }
        
        .weakness-fill.low {
            background: linear-gradient(90deg, #51cf66, #40c057);
        }
        
        .weakness-value {
            width: 45px;
            font-size: 13px;
            text-align: right;
            font-weight: 600;
            color: #495057;
        }
        
        .tips-card {
            background: linear-gradient(135deg, #fff9db 0%, #ffec99 100%);
            border: 1px solid #ffd43b;
            border-radius: 12px;
            padding: 15px;
            margin-top: 15px;
        }
        
        .tips-card h3 {
            font-size: 14px;
            color: #e67700;
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .tips-card ul {
            list-style: none;
            padding-left: 0;
        }
        
        .tips-card li {
            font-size: 13px;
            color: #d9480f;
            padding: 6px 0;
            padding-left: 20px;
            position: relative;
            line-height: 1.5;
        }
        
        .tips-card li:before {
            content: "ğŸ’¡";
            position: absolute;
            left: 0;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #adb5bd;
        }
        
        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 15px;
            opacity: 0.7;
        }
        
        .empty-state-text {
            font-size: 14px;
            line-height: 1.6;
        }

        /* å¼€å§‹ç•Œé¢ */
        .start-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            z-index: 999;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            text-align: center;
            padding: 30px;
        }
        
        .start-screen.hidden {
            display: none;
        }
        
        .start-icon {
            font-size: 80px;
            margin-bottom: 20px;
        }
        
        .start-title {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 10px;
        }
        
        .start-subtitle {
            font-size: 16px;
            opacity: 0.9;
            margin-bottom: 40px;
        }
        
        .start-features {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            width: 100%;
            max-width: 300px;
            margin-bottom: 40px;
        }
        
        .feature-item {
            background: rgba(255,255,255,0.15);
            padding: 15px;
            border-radius: 12px;
            backdrop-filter: blur(10px);
        }
        
        .feature-icon {
            font-size: 24px;
            margin-bottom: 5px;
        }
        
        .feature-text {
            font-size: 12px;
        }
        
        .start-btn {
            background: white;
            color: #667eea;
            border: none;
            padding: 18px 50px;
            border-radius: 30px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: all 0.3s;
        }
        
        .start-btn:active {
            transform: scale(0.95);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        /* åˆ†äº«å¼•å¯¼ */
        .guide-tip {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            display: none;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .guide-tip.show {
            display: flex;
        }
        
        .guide-content {
            background: white;
            border-radius: 16px;
            padding: 25px;
            text-align: center;
            max-width: 300px;
            animation: guidePop 0.3s ease;
        }
        
        @keyframes guidePop {
            0% { transform: scale(0.8); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .guide-arrow {
            font-size: 40px;
            margin-bottom: 15px;
            animation: arrowBounce 1s infinite;
        }
        
        @keyframes arrowBounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .guide-text {
            font-size: 15px;
            color: #495057;
            margin-bottom: 20px;
            line-height: 1.6;
        }
        
        .guide-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
        }

        /* å“åº”å¼ä¼˜åŒ– */
        @media (max-width: 380px) {
            .question-text {
                font-size: 30px;
            }
            
            .answer-input {
                font-size: 24px;
            }
            
            .num-btn {
                padding: 15px;
                font-size: 22px;
            }
        }

        /* å¾®ä¿¡æµè§ˆå™¨é€‚é… */
        .wechat-browser .container {
            min-height: calc(100vh - 10px);
        }
        
        /* é”®ç›˜å¼¹å‡ºæ—¶çš„é€‚é… */
        @media (max-height: 600px) {
            .header {
                padding: 4px;
            }
            .header h1 {
                font-size: 14px;
            }
            .game-stats {
                padding: 4px 6px;
            }
            .stats-bar {
                padding: 4px;
                margin-bottom: 4px;
            }
            .difficulty-selector {
                margin-bottom: 4px;
            }
            .question-card {
                padding: 6px 8px;
                margin-bottom: 4px;
            }
            .question-text {
                font-size: 22px;
                margin-bottom: 4px;
            }
            .answer-input {
                padding: 5px;
                font-size: 18px;
            }
            .feedback {
                margin-top: 3px;
                padding: 4px;
            }
            .btn {
                padding: 6px;
                font-size: 13px;
            }
        }

        /* é”®ç›˜å¼¹å‡ºæ—¶ï¼ˆå±å¹•é«˜åº¦å°äº500pxï¼‰ */
        @media (max-height: 500px) {
            .container {
                border-radius: 8px;
            }
            .header {
                display: none; /* éšè—å¤´éƒ¨ */
            }
            .nav-tabs {
                display: none; /* éšè—å¯¼èˆªæ  */
            }
            .content {
                padding: 4px;
            }
            .game-stats {
                display: none; /* éšè—æ¸¸æˆåŒ–ä¿¡æ¯æ  */
            }
            .stats-bar {
                margin-bottom: 3px;
                padding: 3px;
            }
            .stat-value {
                font-size: 14px;
            }
            .stat-label {
                font-size: 8px;
            }
            .question-text {
                font-size: 20px;
                margin-bottom: 3px;
            }
            .answer-input {
                padding: 4px;
                font-size: 16px;
            }
            .btn {
                padding: 5px;
                font-size: 12px;
            }
        }
        
        /* ä¸‰è¿å‡»å¥–åŠ±åŠ¨ç”» */
        .feedback.bonus {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            color: #d9480f;
            font-size: 18px;
            font-weight: 700;
            animation: bonusPulse 0.5s ease;
        }
        
        .bonus-text {
            display: inline-block;
            animation: bonusScale 0.5s ease;
        }
        
        @keyframes bonusPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        @keyframes bonusScale {
            0% { transform: scale(0.8); opacity: 0; }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); opacity: 1; }
        }
        
        /* æ˜Ÿæ˜Ÿå¥–åŠ±åŠ¨ç”» */
        .star-animation {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 60px;
            animation: starPop 1s ease forwards;
            z-index: 9999;
            pointer-events: none;
        }
        
        @keyframes starPop {
            0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
            50% { transform: translate(-50%, -50%) scale(1.5); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(1) translateY(-100px); opacity: 0; }
        }
        
        /* å‡çº§åŠ¨ç”» */
        .level-up-animation {
            position: fixed;
            top: 30%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 30px;
            border-radius: 15px;
            font-size: 20px;
            font-weight: 700;
            animation: levelUpPop 2s ease forwards;
            z-index: 10000;
            pointer-events: none;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.5);
        }

        @keyframes levelUpPop {
            0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
            20% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
            80% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(1) translateY(-50px); opacity: 0; }
        }

        /* æ­å–œå‡çº§å¼¹çª— */
        .congrats-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10002;
            animation: fadeIn 0.3s ease;
        }

        .congrats-content {
            background: linear-gradient(135deg, #ffd43b 0%, #fcc419 100%);
            padding: 30px 40px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            animation: congratsPop 0.5s ease;
            max-width: 300px;
        }

        @keyframes congratsPop {
            0% { transform: scale(0.5); opacity: 0; }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); opacity: 1; }
        }

        .congrats-icon {
            font-size: 60px;
            margin-bottom: 15px;
            animation: congratsIconBounce 1s ease infinite;
        }

        @keyframes congratsIconBounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        .congrats-title {
            font-size: 28px;
            font-weight: 900;
            color: #d9480f;
            margin-bottom: 10px;
            text-shadow: 2px 2px 0 rgba(255,255,255,0.5);
        }

        .congrats-message {
            font-size: 18px;
            font-weight: 700;
            color: #333;
            margin-bottom: 8px;
        }

        .congrats-encourage {
            font-size: 14px;
            color: #666;
            margin-bottom: 20px;
        }

        .congrats-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: all 0.3s;
        }

        .congrats-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .congrats-btn:active {
            transform: scale(0.98);
        }

        /* å¾—åˆ†å¼¹å‡ºåŠ¨ç”» */
        .score-popup {
            position: fixed;
            top: 40%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #ffd43b;
            font-size: 36px;
            font-weight: 900;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            animation: scoreFloat 1s ease forwards;
            z-index: 9999;
            pointer-events: none;
        }
        
        @keyframes scoreFloat {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
            30% { transform: translate(-50%, -50%) scale(1.3); opacity: 1; }
            100% { transform: translate(-50%, -150%) scale(1); opacity: 0; }
        }
        
        .score-text {
            color: #ffd43b;
            font-weight: 700;
        }
        
        /* æˆå°±è§£é”åŠ¨ç”» */
        .achievement-unlock {
            position: fixed;
            top: 20%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #ffd43b 0%, #fcc419 100%);
            color: #333;
            padding: 15px 20px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            gap: 12px;
            animation: achievementPop 3s ease forwards;
            z-index: 10001;
            pointer-events: none;
            box-shadow: 0 10px 30px rgba(255, 212, 59, 0.5);
            min-width: 250px;
        }
        
        .achievement-icon {
            font-size: 40px;
        }
        
        .achievement-text {
            text-align: left;
        }
        
        .achievement-title {
            font-size: 12px;
            opacity: 0.8;
            margin-bottom: 2px;
        }
        
        .achievement-name {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 2px;
        }
        
        .achievement-desc {
            font-size: 11px;
            opacity: 0.7;
        }
        
        @keyframes achievementPop {
            0% { transform: translate(-50%, -50%) scale(0) rotate(-10deg); opacity: 0; }
            15% { transform: translate(-50%, -50%) scale(1.1) rotate(2deg); opacity: 1; }
            20% { transform: translate(-50%, -50%) scale(1) rotate(0deg); }
            85% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
            100% { transform: translate(-50%, -100%) scale(0.8); opacity: 0; }
        }

        /* ç”¨æˆ·é€‰æ‹©ç•Œé¢ */
        .user-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            z-index: 2000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            text-align: center;
            padding: 20px;
        }

        .user-screen.hidden {
            display: none;
        }

        .user-icon {
            font-size: 60px;
            margin-bottom: 15px;
        }

        .user-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .user-subtitle {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 25px;
        }

        .user-list {
            width: 100%;
            max-width: 300px;
            max-height: 200px;
            overflow-y: auto;
            margin-bottom: 20px;
        }

        .user-item {
            background: rgba(255,255,255,0.15);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 12px 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .user-item:hover {
            background: rgba(255,255,255,0.25);
            transform: scale(1.02);
        }

        .user-item.active {
            border-color: #ffd43b;
            background: rgba(255,212,59,0.2);
        }

        .user-info {
            text-align: left;
        }

        .user-name {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 3px;
        }

        .user-level {
            font-size: 12px;
            opacity: 0.8;
        }

        .user-delete {
            background: rgba(255,107,107,0.8);
            border: none;
            color: white;
            padding: 5px 10px;
            border-radius: 6px;
            font-size: 11px;
            cursor: pointer;
            margin-left: 10px;
        }

        .user-delete:hover {
            background: #ff6b6b;
        }

        .user-actions {
            width: 100%;
            max-width: 300px;
        }

        .user-input {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            text-align: center;
            margin-bottom: 10px;
            background: rgba(255,255,255,0.9);
        }

        .user-btn {
            width: 100%;
            padding: 12px;
            background: white;
            color: #667eea;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .current-user {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 20px;
            background: rgba(255,255,255,0.15);
            padding: 8px 15px;
            border-radius: 20px;
        }

        .switch-user-btn {
            background: transparent;
            border: 2px solid white;
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 12px;
            cursor: pointer;
            margin-top: 10px;
            opacity: 0.8;
        }

        .switch-user-btn:hover {
            opacity: 1;
            background: rgba(255,255,255,0.1);
        }
    </style>
</head>
<body>
    <!-- ç”¨æˆ·é€‰æ‹©ç•Œé¢ -->
    <div class="user-screen" id="user-screen">
        <div class="user-icon">ğŸ‘¤</div>
        <div class="user-title">é€‰æ‹©æ¸¸æˆè§’è‰²</div>
        <div class="user-subtitle">æ¯ä¸ªè§’è‰²æœ‰ç‹¬ç«‹çš„è¿›åº¦</div>
        <div class="user-list" id="user-list">
            <!-- ç”¨æˆ·åˆ—è¡¨å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
        </div>
        <div class="user-actions">
            <input type="text" class="user-input" id="new-username" placeholder="è¾“å…¥æ–°è§’è‰²åå­—" maxlength="10">
            <button class="user-btn" onclick="createNewUser()">åˆ›å»ºæ–°è§’è‰²</button>
        </div>
    </div>

    <!-- å¼€å§‹ç•Œé¢ -->
    <div class="start-screen" id="start-screen">
        <div class="start-icon">ğŸ“</div>
        <div class="start-title">æ•°å­¦å°è¾¾äºº</div>
        <div class="current-user" id="current-user-display">å½“å‰è§’è‰²ï¼šç©å®¶1</div>
        <div class="start-features">
            <div class="feature-item">
                <div class="feature-icon">ğŸ§ </div>
                <div class="feature-text">æ™ºèƒ½å‡ºé¢˜</div>
            </div>
            <div class="feature-item">
                <div class="feature-icon">ğŸ“Š</div>
                <div class="feature-text">é”™é¢˜åˆ†æ</div>
            </div>
            <div class="feature-item">
                <div class="feature-icon">ğŸ¯</div>
                <div class="feature-text">é’ˆå¯¹ç»ƒä¹ </div>
            </div>
            <div class="feature-item">
                <div class="feature-icon">ğŸ†</div>
                <div class="feature-text">æˆç»©è®°å½•</div>
            </div>
        </div>
        <button class="start-btn" onclick="startApp()">å¼€å§‹å­¦ä¹ </button>
        <button class="switch-user-btn" onclick="showUserScreen()">åˆ‡æ¢è§’è‰²</button>
    </div>

    <!-- åˆ†äº«å¼•å¯¼ -->
    <div class="guide-tip" id="share-guide">
        <div class="guide-content">
            <div class="guide-arrow">ğŸ‘†</div>
            <div class="guide-text">ç‚¹å‡»å³ä¸Šè§’èœå•<br>é€‰æ‹©ã€Œå‘é€ç»™æœ‹å‹ã€<br>ä¸€èµ·ç»ƒä¹ æ›´æœ‰è¶£ï¼</div>
            <button class="guide-btn" onclick="hideShareGuide()">æˆ‘çŸ¥é“äº†</button>
        </div>
    </div>

    <div class="container">
        <div class="header">
            <h1>ğŸ“ æ•°å­¦ç»ƒä¹ </h1>
            <div class="subtitle">æ™ºèƒ½å‡ºé¢˜ Â· é’ˆå¯¹è®­ç»ƒ</div>
            <button class="share-btn" onclick="showShareGuide()">åˆ†äº«</button>
        </div>
        
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchPage('practice')">ç»ƒä¹ </button>
            <button class="nav-tab" onclick="switchPage('history')">è®°å½•</button>
            <button class="nav-tab" onclick="switchPage('weakness')">åˆ†æ</button>
        </div>
        
        <div class="content">
            <!-- ç»ƒä¹ é¡µé¢ -->
            <div id="practice-page" class="page active">
                <!-- ğŸ® æ¸¸æˆåŒ–ä¿¡æ¯æ  -->
                <div class="game-stats">
                    <div class="level-info">
                        <div class="level-badge" id="level-badge">Lv.1</div>
                        <div class="title-badge" id="title-badge">ğŸŒ± æ•°å­¦æ–°æ‰‹</div>
                    </div>
                    <div class="score-info">
                        <div class="score-display">ğŸ† <span id="total-score">0</span> åˆ†</div>
                    </div>
                    <div class="exp-bar-container">
                        <div class="exp-bar" id="exp-bar">
                            <div class="exp-fill" id="exp-fill"></div>
                        </div>
                        <div class="exp-text" id="exp-text">0/100</div>
                    </div>
                </div>
                
                <div class="stats-bar">
                    <div class="stat-item">
                        <div class="stat-value" id="total-count">0</div>
                        <div class="stat-label">æ€»é¢˜æ•°</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="correct-count">0</div>
                        <div class="stat-label">æ­£ç¡®</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="wrong-count">0</div>
                        <div class="stat-label">é”™è¯¯</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="accuracy">0%</div>
                        <div class="stat-label">æ­£ç¡®ç‡</div>
                    </div>
                </div>
                
                <div class="difficulty-selector">
                    <label>é€‰æ‹©éš¾åº¦ï¼š</label>
                    <div class="difficulty-btns">
                        <button class="difficulty-btn active" onclick="setDifficulty('easy')">ç®€å•</button>
                        <button class="difficulty-btn" onclick="setDifficulty('medium')">ä¸­ç­‰</button>
                        <button class="difficulty-btn" onclick="setDifficulty('hard')">å›°éš¾</button>
                    </div>
                </div>
                
                <div class="question-card" id="question-card">
                    <div class="question-text" id="question-text">ç‚¹å‡»å¼€å§‹ç»ƒä¹ </div>
                    <input type="number" 
                           class="answer-input" 
                           id="answer-input" 
                           placeholder="è¾“å…¥ç­”æ¡ˆ" 
                           inputmode="numeric"
                           pattern="[0-9]*"
                           autocomplete="off">
                    <div class="feedback" id="feedback"></div>
                </div>
                
                <button class="btn btn-primary" id="action-btn" onclick="handleAction()">å¼€å§‹ç»ƒä¹ </button>
                
                <!-- æ•°å­—é”®ç›˜å·²ç¦ç”¨ï¼Œä½¿ç”¨ç³»ç»Ÿé”®ç›˜ -->
                <div class="number-pad" id="number-pad" style="display: none;"></div>
            </div>
            
            <!-- å†å²è®°å½•é¡µé¢ -->
            <div id="history-page" class="page">
                <div class="history-header">
                    <h2>ğŸ“Š ç»ƒä¹ è®°å½•</h2>
                    <button class="clear-btn" onclick="clearHistory()">æ¸…ç©º</button>
                </div>
                
                <div class="summary-cards">
                    <div class="summary-card">
                        <div class="number" id="history-total">0</div>
                        <div class="label">æ€»é¢˜æ•°</div>
                    </div>
                    <div class="summary-card">
                        <div class="number" id="history-correct">0</div>
                        <div class="label">æ­£ç¡®</div>
                    </div>
                    <div class="summary-card">
                        <div class="number" id="history-wrong">0</div>
                        <div class="label">é”™è¯¯</div>
                    </div>
                    <div class="summary-card">
                        <div class="number" id="history-accuracy">0%</div>
                        <div class="label">æ­£ç¡®ç‡</div>
                    </div>
                </div>
                
                <div class="history-list" id="history-list">
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ“‹</div>
                        <div class="empty-state-text">æš‚æ— ç»ƒä¹ è®°å½•</div>
                    </div>
                </div>
            </div>
            
            <!-- é”™é¢˜åˆ†æé¡µé¢ -->
            <div id="weakness-page" class="page">
                <div class="weakness-header">
                    <h2>ğŸ” è–„å¼±ç‚¹åˆ†æ</h2>
                    <p>ç³»ç»Ÿæ ¹æ®é”™é¢˜ç±»å‹è‡ªåŠ¨è°ƒæ•´å‡ºé¢˜æ¯”ä¾‹<br>é”™è¯¯è¶Šå¤šï¼Œè¯¥ç±»å‹é¢˜ç›®å‡ºç°æ¦‚ç‡è¶Šé«˜</p>
                </div>
                
                <div class="weakness-chart" id="weakness-chart">
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ“Š</div>
                        <div class="empty-state-text">æš‚æ— è¶³å¤Ÿæ•°æ®è¿›è¡Œåˆ†æ<br>è¯·å…ˆå®Œæˆä¸€äº›ç»ƒä¹ </div>
                    </div>
                </div>
                
                <div class="tips-card" id="tips-card" style="display: none;">
                    <h3>ğŸ’¡ å­¦ä¹ å»ºè®®</h3>
                    <ul id="tips-list"></ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        // æ£€æµ‹æ˜¯å¦åœ¨GitHub Pagesç¯å¢ƒ
        const isGitHubPages = window.location.hostname.includes('github.io');

        // ğŸ‘¤ ç”¨æˆ·ç³»ç»Ÿ
        let currentUser = localStorage.getItem('mathCurrentUser') || null;
        let users = JSON.parse(localStorage.getItem('mathUsers')) || {};

        // å¦‚æœç”¨æˆ·ç³»ç»Ÿä¸å­˜åœ¨ï¼Œåˆ›å»ºé»˜è®¤ç”¨æˆ·
        if (Object.keys(users).length === 0) {
            createDefaultUser();
        }

        // æ•°æ®å­˜å‚¨ï¼ˆç”¨æˆ·éš”ç¦»ï¼‰
        function getUserData(userName) {
            if (!users[userName]) return null;
            return users[userName];
        }

        function saveUserData(userName, data) {
            if (!users[userName]) return;
            users[userName] = { ...users[userName], ...data };
            localStorage.setItem('mathUsers', JSON.stringify(users));
        }

        function createDefaultUser() {
            const defaultUser = {
                name: 'ç©å®¶1',
                createdAt: new Date().toISOString(),
                historyData: [],
                weaknessData: {
                    addition: { total: 0, wrong: 0 },
                    subtraction: { total: 0, wrong: 0 },
                    multiplication: { total: 0, wrong: 0 },
                    division: { total: 0, wrong: 0 },
                    mixed: { total: 0, wrong: 0 }
                },
                totalScore: 0,
                currentLevel: 1,
                currentExp: 0,
                achievements: {
                    'first_correct': { name: 'ğŸ¯ åˆå‡ºèŒ…åº', desc: 'é¦–æ¬¡ç­”å¯¹é¢˜ç›®', unlocked: false },
                    'streak_5': { name: 'ğŸ”¥ è¿å‡»é«˜æ‰‹', desc: 'è¿ç»­ç­”å¯¹5é¢˜', unlocked: false },
                    'streak_10': { name: 'âš¡ å®Œç¾è¿å‡»', desc: 'è¿ç»­ç­”å¯¹10é¢˜', unlocked: false },
                    'speed_demon': { name: 'ğŸ’¨ é—ªç”µä¾ ', desc: '3ç§’å†…ç­”å¯¹ä¸€é¢˜', unlocked: false },
                    'group_perfect': { name: 'ğŸ’¯ å…¨å¯¹å¤§å¸ˆ', desc: 'ä¸€ç»„é¢˜ç›®å…¨å¯¹', unlocked: false },
                    'level_5': { name: 'ğŸ“ˆ å‡çº§è¾¾äºº', desc: 'è¾¾åˆ°5çº§', unlocked: false },
                    'level_10': { name: 'ğŸ“ æ•°å­¦ä¸“å®¶', desc: 'è¾¾åˆ°10çº§', unlocked: false }
                },
                bestTime: 999,
                currentDifficulty: 'easy'
            };
            users['ç©å®¶1'] = defaultUser;
            currentUser = 'ç©å®¶1';
            localStorage.setItem('mathUsers', JSON.stringify(users));
            localStorage.setItem('mathCurrentUser', currentUser);
        }

        function createNewUser() {
            const userNameInput = document.getElementById('new-username');
            const userName = userNameInput.value.trim();

            if (!userName) {
                alert('è¯·è¾“å…¥è§’è‰²åå­—');
                return;
            }

            if (users[userName]) {
                alert('è¯¥è§’è‰²å·²å­˜åœ¨ï¼Œè¯·é€‰æ‹©å…¶ä»–åå­—');
                return;
            }

            const newUser = {
                name: userName,
                createdAt: new Date().toISOString(),
                historyData: [],
                weaknessData: {
                    addition: { total: 0, wrong: 0 },
                    subtraction: { total: 0, wrong: 0 },
                    multiplication: { total: 0, wrong: 0 },
                    division: { total: 0, wrong: 0 },
                    mixed: { total: 0, wrong: 0 }
                },
                totalScore: 0,
                currentLevel: 1,
                currentExp: 0,
                achievements: {
                    'first_correct': { name: 'ğŸ¯ åˆå‡ºèŒ…åº', desc: 'é¦–æ¬¡ç­”å¯¹é¢˜ç›®', unlocked: false },
                    'streak_5': { name: 'ğŸ”¥ è¿å‡»é«˜æ‰‹', desc: 'è¿ç»­ç­”å¯¹5é¢˜', unlocked: false },
                    'streak_10': { name: 'âš¡ å®Œç¾è¿å‡»', desc: 'è¿ç»­ç­”å¯¹10é¢˜', unlocked: false },
                    'speed_demon': { name: 'ğŸ’¨ é—ªç”µä¾ ', desc: '3ç§’å†…ç­”å¯¹ä¸€é¢˜', unlocked: false },
                    'group_perfect': { name: 'ğŸ’¯ å…¨å¯¹å¤§å¸ˆ', desc: 'ä¸€ç»„é¢˜ç›®å…¨å¯¹', unlocked: false },
                    'level_5': { name: 'ğŸ“ˆ å‡çº§è¾¾äºº', desc: 'è¾¾åˆ°5çº§', unlocked: false },
                    'level_10': { name: 'ğŸ“ æ•°å­¦ä¸“å®¶', desc: 'è¾¾åˆ°10çº§', unlocked: false }
                },
                bestTime: 999,
                currentDifficulty: 'easy'
            };

            users[userName] = newUser;
            localStorage.setItem('mathUsers', JSON.stringify(users));
            userNameInput.value = '';
            renderUserList();
            alert(`è§’è‰² "${userName}" åˆ›å»ºæˆåŠŸï¼`);
        }

        function deleteUser(userName, event) {
            event.stopPropagation();
            if (Object.keys(users).length <= 1) {
                alert('è‡³å°‘éœ€è¦ä¿ç•™ä¸€ä¸ªè§’è‰²');
                return;
            }
            if (confirm(`ç¡®å®šè¦åˆ é™¤è§’è‰² "${userName}" å—ï¼Ÿæ‰€æœ‰æ•°æ®å°†è¢«æ¸…é™¤ã€‚`)) {
                delete users[userName];
                localStorage.setItem('mathUsers', JSON.stringify(users));
                if (currentUser === userName) {
                    currentUser = Object.keys(users)[0];
                    localStorage.setItem('mathCurrentUser', currentUser);
                }
                renderUserList();
            }
        }

        function selectUser(userName) {
            currentUser = userName;
            localStorage.setItem('mathCurrentUser', currentUser);
            loadUserData();
            renderUserList();

            // æ˜¾ç¤ºå¼€å§‹ç•Œé¢
            document.getElementById('user-screen').classList.add('hidden');
            document.getElementById('start-screen').classList.remove('hidden');
            document.getElementById('current-user-display').textContent = `å½“å‰è§’è‰²ï¼š${currentUser}`;
        }

        function showUserScreen() {
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('user-screen').classList.remove('hidden');
            renderUserList();
        }

        function renderUserList() {
            const userList = document.getElementById('user-list');
            userList.innerHTML = '';

            Object.keys(users).forEach(userName => {
                const user = users[userName];
                const userItem = document.createElement('div');
                userItem.className = `user-item ${currentUser === userName ? 'active' : ''}`;
                userItem.onclick = () => selectUser(userName);

                userItem.innerHTML = `
                    <div class="user-info">
                        <div class="user-name">${userName}</div>
                        <div class="user-level">Lv.${user.currentLevel} Â· ${user.totalScore}åˆ†</div>
                    </div>
                    <button class="user-delete" onclick="deleteUser('${userName}', event)">åˆ é™¤</button>
                `;

                userList.appendChild(userItem);
            });
        }

        function loadUserData() {
            if (!currentUser || !users[currentUser]) {
                currentUser = Object.keys(users)[0];
                localStorage.setItem('mathCurrentUser', currentUser);
            }

            const userData = users[currentUser];
            historyData = userData.historyData || [];
            weaknessData = userData.weaknessData || {
                addition: { total: 0, wrong: 0 },
                subtraction: { total: 0, wrong: 0 },
                multiplication: { total: 0, wrong: 0 },
                division: { total: 0, wrong: 0 },
                mixed: { total: 0, wrong: 0 }
            };
            totalScore = userData.totalScore || 0;
            currentLevel = userData.currentLevel || 1;
            currentExp = userData.currentExp || 0;
            achievements = userData.achievements || {};
            bestTime = userData.bestTime || 999;
            currentDifficulty = userData.currentDifficulty || 'easy';

            updateStats();
            updateGameStats();
            updateDifficultyButtons();
        }

        function saveCurrentUserData() {
            if (!currentUser) return;

            const userData = {
                name: currentUser,
                historyData: historyData,
                weaknessData: weaknessData,
                totalScore: totalScore,
                currentLevel: currentLevel,
                currentExp: currentExp,
                achievements: achievements,
                bestTime: bestTime,
                currentDifficulty: currentDifficulty
            };

            saveUserData(currentUser, userData);
        }

        // æ•°æ®å­˜å‚¨
        let historyData = [];
        let weaknessData = {
            addition: { total: 0, wrong: 0 },
            subtraction: { total: 0, wrong: 0 },
            multiplication: { total: 0, wrong: 0 },
            division: { total: 0, wrong: 0 },
            mixed: { total: 0, wrong: 0 }
        };

        let currentQuestion = null;
        let isAnswering = false;
        let currentDifficulty = 'easy';
        let consecutiveCorrect = 0; // è¿ç»­ç­”å¯¹è®¡æ•°å™¨

        // ç»„é¢˜è®¾ç½®
        const GROUP_SIZE = 10; // æ¯ç»„10é“é¢˜
        let currentGroupCount = 0; // å½“å‰ç»„å†…é¢˜ç›®è®¡æ•°
        let groupCorrectCount = 0; // å½“å‰ç»„å†…æ­£ç¡®é¢˜æ•°

        // ğŸ® æ¸¸æˆåŒ–ç³»ç»Ÿ
        let totalScore = 0;
        let currentLevel = 1;
        let currentExp = 0;
        let expToNextLevel = currentLevel * 100;

        // ç§°å·ç³»ç»Ÿ
        const titles = [
            { level: 1, title: 'ğŸŒ± æ•°å­¦æ–°æ‰‹', color: '#51cf66' },
            { level: 5, title: 'ğŸ“š è®¡ç®—å­¦å¾’', color: '#339af0' },
            { level: 10, title: 'âš¡ é€Ÿç®—è¾¾äºº', color: '#ff6b6b' },
            { level: 20, title: 'ğŸ† æ•°å­¦å¤§å¸ˆ', color: '#ffd43b' },
            { level: 30, title: 'ğŸ‘‘ æ•°å­¦ç‹è€…', color: '#a855f7' }
        ];

        // æˆå°±ç³»ç»Ÿ
        let achievements = {};

        // è®¡æ—¶ç³»ç»Ÿ
        let questionStartTime = 0;
        let bestTime = 999;

        // éŸ³æ•ˆè®¾ç½®ï¼ˆè¶…çº§ç›ä¸½é‡‘å¸å£°ï¼‰
        const correctSound = new Audio('https://assets.mixkit.co/active_storage/sfx/2000/2000-preview.mp3');
        correctSound.volume = 0.5; // 50%éŸ³é‡

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // æ£€æµ‹å¾®ä¿¡æµè§ˆå™¨
            const isWechat = /MicroMessenger/i.test(navigator.userAgent);
            if (isWechat) {
                document.body.classList.add('wechat-browser');
            }

            // åŠ è½½ç”¨æˆ·æ•°æ®
            loadUserData();

            // å¦‚æœæ²¡æœ‰å½“å‰ç”¨æˆ·ï¼Œæ˜¾ç¤ºç”¨æˆ·é€‰æ‹©ç•Œé¢
            if (!currentUser) {
                document.getElementById('user-screen').classList.remove('hidden');
                document.getElementById('start-screen').classList.add('hidden');
                renderUserList();
            } else {
                document.getElementById('user-screen').classList.add('hidden');
                document.getElementById('start-screen').classList.remove('hidden');
                document.getElementById('current-user-display').textContent = `å½“å‰è§’è‰²ï¼š${currentUser}`;
            }

            // ç›‘å¬è¾“å…¥æ¡†è¾“å…¥äº‹ä»¶ï¼Œå®ç°è‡ªåŠ¨æäº¤
            const answerInput = document.getElementById('answer-input');
            answerInput.addEventListener('input', function(e) {
                if (!isAnswering || !currentQuestion) return;

                const inputValue = e.target.value;
                const correctAnswer = currentQuestion.answer;
                const answerLength = String(correctAnswer).length;

                // å½“è¾“å…¥ä½æ•°ç­‰äºç­”æ¡ˆä½æ•°æ—¶ï¼Œè‡ªåŠ¨æäº¤
                if (inputValue.length === answerLength) {
                    // å»¶è¿Ÿ100msï¼Œè®©ç”¨æˆ·çœ‹åˆ°è¾“å…¥çš„æ•°å­—
                    setTimeout(() => {
                        submitAnswer();
                    }, 100);
                }
            });

            updateStats();
            updateGameStats(); // åˆå§‹åŒ–æ¸¸æˆåŒ–UI
        });
        
        // å¼€å§‹åº”ç”¨
        function startApp() {
            document.getElementById('start-screen').classList.add('hidden');
            updateStats();
            updateGameStats();
            renderHistory();
            renderWeakness();
        }
        
        // é¡µé¢åˆ‡æ¢
        function switchPage(page) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            
            document.getElementById(page + '-page').classList.add('active');
            event.target.classList.add('active');
            
            if (page === 'history') {
                renderHistory();
            } else if (page === 'weakness') {
                renderWeakness();
            }
        }
        
        // è®¾ç½®éš¾åº¦
        function setDifficulty(level) {
            currentDifficulty = level;
            document.querySelectorAll('.difficulty-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
        }
        
        // ç”Ÿæˆé¢˜ç›®
        function generateQuestion() {
            const types = ['addition', 'subtraction', 'multiplication', 'division'];
            
            // è®¡ç®—æƒé‡
            let weights = types.map(type => {
                const data = weaknessData[type];
                if (data.total === 0) return 1;
                const errorRate = data.wrong / data.total;
                return 0.3 + errorRate * 2;
            });
            
            // æ ¹æ®éš¾åº¦è°ƒæ•´
            if (currentDifficulty === 'easy') {
                weights[0] *= 1.5;
                weights[1] *= 1.3;
            } else if (currentDifficulty === 'hard') {
                weights[2] *= 1.5;
                weights[3] *= 1.3;
            }
            
            // åŠ æƒéšæœºé€‰æ‹©
            const totalWeight = weights.reduce((a, b) => a + b, 0);
            let random = Math.random() * totalWeight;
            let selectedType = types[0];
            
            for (let i = 0; i < types.length; i++) {
                random -= weights[i];
                if (random <= 0) {
                    selectedType = types[i];
                    break;
                }
            }
            
            let question = {};
            
            switch(selectedType) {
                case 'addition':
                    question = generateAddition();
                    break;
                case 'subtraction':
                    question = generateSubtraction();
                    break;
                case 'multiplication':
                    question = generateMultiplication();
                    break;
                case 'division':
                    question = generateDivision();
                    break;
            }
            
            question.type = selectedType;
            return question;
        }
        
        // ç”ŸæˆåŠ æ³•é¢˜ - é€‚åˆä¸‰å¹´çº§ï¼šä¸‡ä»¥å†…çš„åŠ æ³•
        function generateAddition() {
            let a, b;
            if (currentDifficulty === 'easy') {
                // ç®€å•ï¼šä¸¤ä½æ•°åŠ ä¸¤ä½æ•°ï¼ˆå’Œä¸è¶…100ï¼‰
                a = Math.floor(Math.random() * 50) + 10; // 10-59
                b = Math.floor(Math.random() * (100 - a - 10)) + 10; // ç¡®ä¿å’Œåœ¨100ä»¥å†…
                if (b < 10) b = 10;
            } else if (currentDifficulty === 'medium') {
                // ä¸­ç­‰ï¼šä¸‰ä½æ•°åŠ ä¸¤ä½æ•°æˆ–ä¸‰ä½æ•°åŠ ä¸‰ä½æ•°ï¼ˆå’Œä¸è¶…1000ï¼‰
                a = Math.floor(Math.random() * 400) + 100; // 100-499
                b = Math.floor(Math.random() * (900 - a)) + 10; // 10-999ï¼Œç¡®ä¿å’Œä¸è¶…1000
                if (b < 10) b = 10;
            } else {
                // å›°éš¾ï¼šä¸‰ä½æ•°åŠ ä¸‰ä½æ•°ï¼ˆå’Œä¸è¶…1000ï¼‰
                a = Math.floor(Math.random() * 400) + 300; // 300-699
                b = Math.floor(Math.random() * (1000 - a - 50)) + 50; // ç¡®ä¿å’Œä¸è¶…1000
                if (b > 999) b = 999;
            }

            return {
                text: `${a} + ${b} = ?`,
                answer: a + b,
                display: `${a} + ${b}`
            };
        }

        // ç”Ÿæˆå‡æ³•é¢˜ - é€‚åˆä¸‰å¹´çº§ï¼šä¸‡ä»¥å†…çš„å‡æ³•
        function generateSubtraction() {
            let a, b;
            if (currentDifficulty === 'easy') {
                // ç®€å•ï¼šä¸¤ä½æ•°å‡ä¸¤ä½æ•°ï¼ˆå¤Ÿå‡ï¼Œå·®ä¸è¶…50ï¼‰
                a = Math.floor(Math.random() * 40) + 30; // 30-69
                b = Math.floor(Math.random() * (a - 10)) + 10; // 10åˆ°a-10ï¼Œç¡®ä¿å¤Ÿå‡
            } else if (currentDifficulty === 'medium') {
                // ä¸­ç­‰ï¼šä¸‰ä½æ•°å‡ä¸¤ä½æ•°æˆ–ä¸‰ä½æ•°å‡ä¸‰ä½æ•°
                a = Math.floor(Math.random() * 400) + 200; // 200-599
                b = Math.floor(Math.random() * (a - 50)) + 10; // ç¡®ä¿å¤Ÿå‡
            } else {
                // å›°éš¾ï¼šä¸‰ä½æ•°å‡ä¸‰ä½æ•°ï¼Œå¯èƒ½éœ€è¦é€€ä½
                a = Math.floor(Math.random() * 400) + 400; // 400-799
                b = Math.floor(Math.random() * (a - 100)) + 50; // ç¡®ä¿å¤Ÿå‡
            }

            return {
                text: `${a} - ${b} = ?`,
                answer: a - b,
                display: `${a} - ${b}`
            };
        }

        // ç”Ÿæˆä¹˜æ³•é¢˜ - é€‚åˆä¸‰å¹´çº§ï¼šå¤šä½æ•°ä¹˜ä¸€ä½æ•°
        function generateMultiplication() {
            let a, b;
            if (currentDifficulty === 'easy') {
                // ç®€å•ï¼šè¡¨å†…ä¹˜æ³•ï¼ˆ1-9ä¹˜æ³•å£è¯€ï¼‰
                a = Math.floor(Math.random() * 9) + 1;
                b = Math.floor(Math.random() * 9) + 1;
            } else if (currentDifficulty === 'medium') {
                // ä¸­ç­‰ï¼šä¸¤ä½æ•°ä¹˜ä¸€ä½æ•°ï¼ˆä¸è¿›ä½æˆ–ç®€å•è¿›ä½ï¼Œç§¯ä¸è¶…200ï¼‰
                b = Math.floor(Math.random() * 8) + 2; // ä¹˜æ•°2-9
                a = Math.floor(Math.random() * (Math.floor(200 / b) - 10)) + 11; // ç¡®ä¿ç§¯ä¸è¶…200
                if (a < 10) a = 10;
            } else {
                // å›°éš¾ï¼šä¸¤ä½æ•°ä¹˜ä¸€ä½æ•°ï¼ˆç§¯ä¸è¶…500ï¼‰
                b = Math.floor(Math.random() * 7) + 3; // ä¹˜æ•°3-9
                a = Math.floor(Math.random() * (Math.floor(500 / b) - 10)) + 11; // ç¡®ä¿ç§¯ä¸è¶…500
                if (a < 10) a = 10;
            }

            return {
                text: `${a} Ã— ${b} = ?`,
                answer: a * b,
                display: `${a} Ã— ${b}`
            };
        }

        // ç”Ÿæˆé™¤æ³•é¢˜ - é€‚åˆä¸‰å¹´çº§ï¼šé™¤æ•°æ˜¯ä¸€ä½æ•°çš„é™¤æ³•
        function generateDivision() {
            let a, b, result;
            if (currentDifficulty === 'easy') {
                // ç®€å•ï¼šè¡¨å†…é™¤æ³•ï¼ˆä¹˜æ³•å£è¯€é€†è¿ç®—ï¼Œå•†æ˜¯ä¸€ä½æ•°ï¼‰
                b = Math.floor(Math.random() * 8) + 2; // é™¤æ•°2-9
                result = Math.floor(Math.random() * 9) + 1; // å•†1-9
                a = b * result; // è¢«é™¤æ•°ä¸è¶…81
            } else if (currentDifficulty === 'medium') {
                // ä¸­ç­‰ï¼šä¸¤ä½æ•°é™¤ä»¥ä¸€ä½æ•°ï¼ˆæ•´é™¤ï¼Œå•†æ˜¯ä¸¤ä½æ•°ï¼‰
                b = Math.floor(Math.random() * 7) + 2; // é™¤æ•°2-8
                result = Math.floor(Math.random() * 11) + 10; // å•†10-20
                a = b * result; // è¢«é™¤æ•°ä¸è¶…160
            } else {
                // å›°éš¾ï¼šä¸¤ä½æ•°é™¤ä»¥ä¸€ä½æ•°ï¼ˆæœ‰ä½™æ•°æˆ–è¾ƒå¤§æ•°ï¼‰
                b = Math.floor(Math.random() * 7) + 2; // é™¤æ•°2-8
                result = Math.floor(Math.random() * 25) + 5; // å•†5-29
                a = b * result + Math.floor(Math.random() * (b - 1)); // å¯èƒ½æœ‰ä½™æ•°ï¼Œè¢«é™¤æ•°ä¸è¶…300
                if (a > 300) {
                    a = b * result; // ç¡®ä¿ä¸è¶…300
                }
            }

            return {
                text: `${a} Ã· ${b} = ?`,
                answer: result,
                display: `${a} Ã· ${b}`
            };
        }
        
        // å¤„ç†æŒ‰é’®åŠ¨ä½œ
        function handleAction() {
            const btnText = document.getElementById('action-btn').textContent;
            if (!isAnswering) {
                if (btnText === 'ä¸‹ä¸€é¢˜') {
                    // å¦‚æœæ˜¾ç¤ºä¸‹ä¸€é¢˜ï¼Œç‚¹å‡»åå¼€å§‹æ–°é¢˜ç›®
                    startPractice();
                } else {
                    startPractice();
                }
            }
            // ç­”é¢˜è¿‡ç¨‹ä¸­æŒ‰é’®ä¸å¯ç‚¹å‡»ï¼Œç”±ç¨‹åºè‡ªåŠ¨åˆ¤æ–­
        }
        
        // å¼€å§‹ç»ƒä¹ 
        function startPractice() {
            isAnswering = true;
            currentQuestion = generateQuestion();
            
            // å¢åŠ ç»„å†…è®¡æ•°
            currentGroupCount++;
            
            // è®°å½•é¢˜ç›®å¼€å§‹æ—¶é—´
            questionStartTime = Date.now();
            
            document.getElementById('question-text').textContent = currentQuestion.text;
            document.getElementById('answer-input').value = '';
            const actionBtn = document.getElementById('action-btn');
            actionBtn.textContent = `ç¬¬ ${currentGroupCount}/${GROUP_SIZE} é¢˜`;
            actionBtn.disabled = true;
            document.getElementById('question-card').className = 'question-card';
            document.getElementById('feedback').className = 'feedback';
            // éšè—æ•°å­—é”®ç›˜ï¼Œä½¿ç”¨ç³»ç»Ÿé”®ç›˜
            document.getElementById('number-pad').style.display = 'none';
            
            // è‡ªåŠ¨èšç„¦è¾“å…¥æ¡†ï¼Œè°ƒèµ·ç³»ç»Ÿé”®ç›˜
            setTimeout(() => {
                document.getElementById('answer-input').focus();
            }, 100);
            
            const feedback = document.getElementById('feedback');
            feedback.classList.remove('show');
        }
        
        // è¾“å…¥æ•°å­—
        function inputNumber(num) {
            const input = document.getElementById('answer-input');
            if (input.value.length < 6) {
                input.value += num;
            }
        }
        
        // æ¸…é™¤è¾“å…¥
        function clearInput() {
            document.getElementById('answer-input').value = '';
        }
        
        // æäº¤ç­”æ¡ˆ
        function submitAnswer() {
            if (!currentQuestion) return;
            
            const userAnswer = parseInt(document.getElementById('answer-input').value);
            if (isNaN(userAnswer)) {
                alert('è¯·è¾“å…¥ç­”æ¡ˆ');
                return;
            }
            
            const correctAnswer = currentQuestion.answer;
            const isCorrect = userAnswer === correctAnswer;
            
            // æ›´æ–°è–„å¼±ç‚¹æ•°æ®
            weaknessData[currentQuestion.type].total++;
            if (!isCorrect) {
                weaknessData[currentQuestion.type].wrong++;
            }

            // æ·»åŠ åˆ°å†å²è®°å½•
            const record = {
                question: currentQuestion.display,
                userAnswer: userAnswer,
                correctAnswer: correctAnswer,
                isCorrect: isCorrect,
                type: currentQuestion.type,
                timestamp: new Date().toISOString()
            };
            historyData.unshift(record);
            if (historyData.length > 100) {
                historyData = historyData.slice(0, 100);
            }
            
            // æ˜¾ç¤ºç»“æœ
            const card = document.getElementById('question-card');
            const feedback = document.getElementById('feedback');
            
            if (isCorrect) {
                card.classList.add('correct');
                consecutiveCorrect++; // å¢åŠ è¿ç»­ç­”å¯¹è®¡æ•°
                groupCorrectCount++; // å¢åŠ ç»„å†…æ­£ç¡®è®¡æ•°
                
                // ğŸ® è®¡ç®—ç§¯åˆ†å’Œç»éªŒ
                const answerTime = (Date.now() - questionStartTime) / 1000; // ç­”é¢˜æ—¶é—´ï¼ˆç§’ï¼‰
                let points = 10; // åŸºç¡€åˆ†
                let expGain = 10; // åŸºç¡€ç»éªŒ
                
                // é€Ÿåº¦å¥–åŠ±
                if (answerTime <= 3) {
                    points += 5;
                    expGain += 5;
                    checkAchievement('speed_demon');
                }
                
                // è¿å‡»å¥–åŠ±
                if (consecutiveCorrect >= 5) {
                    points += 10;
                    expGain += 10;
                }
                
                // éš¾åº¦å¥–åŠ±
                if (currentDifficulty === 'medium') {
                    points += 5;
                    expGain += 5;
                } else if (currentDifficulty === 'hard') {
                    points += 10;
                    expGain += 10;
                }
                
                // æ›´æ–°æ€»åˆ†
                totalScore += points;

                // æ›´æ–°ç»éªŒå€¼
                currentExp += expGain;
                let levelUp = false;
                while (currentExp >= expToNextLevel) {
                    currentExp -= expToNextLevel;
                    currentLevel++;
                    expToNextLevel = currentLevel * 100;
                    levelUp = true;
                }
                
                // æ£€æŸ¥æˆå°±
                checkAchievement('first_correct');
                if (consecutiveCorrect >= 5) checkAchievement('streak_5');
                if (consecutiveCorrect >= 10) checkAchievement('streak_10');
                if (currentLevel >= 5) checkAchievement('level_5');
                if (currentLevel >= 10) checkAchievement('level_10');
                
                // æ’­æ”¾æ­£ç¡®éŸ³æ•ˆ
                correctSound.currentTime = 0;
                correctSound.play().catch(e => console.log('éŸ³æ•ˆæ’­æ”¾å¤±è´¥:', e));
                
                // æ˜¾ç¤ºå¾—åˆ†åŠ¨ç”»
                showScoreAnimation(points, expGain);
                
                // æ£€æŸ¥æ˜¯å¦ä¸‰è¿å‡»
                if (consecutiveCorrect === 3) {
                    feedback.innerHTML = `ğŸ‰ <span class="bonus-text">ä¸‰è¿å‡»ï¼+${points}åˆ†</span> ğŸ‰`;
                    feedback.className = 'feedback success show bonus';
                    showBonusAnimation(); // æ˜¾ç¤ºå¥–åŠ±åŠ¨ç”»
                } else {
                    feedback.innerHTML = `ğŸ‰ æ­£ç¡®ï¼<span class="score-text">+${points}åˆ†</span>`;
                    feedback.className = 'feedback success show';
                }
                
                // å¦‚æœå‡çº§äº†ï¼Œæ˜¾ç¤ºå‡çº§åŠ¨ç”»
                if (levelUp) {
                    setTimeout(() => {
                        showLevelUpAnimation(`Lv.${currentLevel}`);
                    }, 500);
                }
            } else {
                card.classList.add('wrong');
                consecutiveCorrect = 0; // ç­”é”™é‡ç½®è®¡æ•°
                feedback.textContent = `âŒ å›ç­”é”™è¯¯ã€‚æ­£ç¡®ç­”æ¡ˆæ˜¯ ${correctAnswer}`;
                feedback.className = 'feedback error show';
            }
            
            updateStats();
            
            // æ£€æŸ¥æ˜¯å¦å®Œæˆä¸€ç»„ï¼ˆ10é“é¢˜ï¼‰
            let btnText = 'ä¸‹ä¸€é¢˜';
            if (currentGroupCount >= GROUP_SIZE) {
                // è®¡ç®—ç»„å†…æ­£ç¡®ç‡
                const groupAccuracy = (groupCorrectCount / GROUP_SIZE) * 100;
                
                if (groupAccuracy === 100) {
                    // æ­£ç¡®ç‡100%ï¼Œè‡ªåŠ¨å‡çº§éš¾åº¦
                    checkAchievement('group_perfect'); // è§£é”å…¨å¯¹æˆå°±
                    if (currentDifficulty === 'easy') {
                        currentDifficulty = 'medium';
                        btnText = 'ğŸ‰ å‡çº§åˆ°ä¸­çº§ï¼';
                        showLevelUpAnimation('ä¸­çº§');
                    } else if (currentDifficulty === 'medium') {
                        currentDifficulty = 'hard';
                        btnText = 'ğŸ‰ å‡çº§åˆ°å›°éš¾ï¼';
                        showLevelUpAnimation('å›°éš¾');
                    } else {
                        btnText = 'ğŸ‰ å·²å®Œæˆå›°éš¾ï¼';
                    }
                } else {
                    btnText = `ç»„å®Œæˆï¼æ­£ç¡®ç‡ ${groupAccuracy}%`;
                }
                
                // é‡ç½®ç»„è®¡æ•°
                currentGroupCount = 0;
                groupCorrectCount = 0;
                
                // æ›´æ–°éš¾åº¦æŒ‰é’®æ˜¾ç¤º
                updateDifficultyButtons();
            }
            
            const actionBtn = document.getElementById('action-btn');
            actionBtn.textContent = btnText;
            actionBtn.disabled = false;
            isAnswering = false;

            // ä¿å­˜ç”¨æˆ·æ•°æ®
            saveCurrentUserData();
        }
        
        // æ›´æ–°ç»Ÿè®¡
        function updateStats() {
            const total = historyData.length;
            const correct = historyData.filter(h => h.isCorrect).length;
            const wrong = total - correct;
            const accuracy = total > 0 ? Math.round((correct / total) * 100) : 0;
            
            document.getElementById('total-count').textContent = total;
            document.getElementById('correct-count').textContent = correct;
            document.getElementById('wrong-count').textContent = wrong;
            document.getElementById('accuracy').textContent = accuracy + '%';
            
            // ğŸ® æ›´æ–°æ¸¸æˆåŒ–UI
            updateGameStats();
        }
        
        // ğŸ® æ›´æ–°æ¸¸æˆåŒ–ç»Ÿè®¡
        function updateGameStats() {
            // æ›´æ–°ç­‰çº§å’Œç§°å·
            document.getElementById('level-badge').textContent = `Lv.${currentLevel}`;
            const currentTitle = getCurrentTitle();
            const titleBadge = document.getElementById('title-badge');
            titleBadge.textContent = currentTitle.title;
            titleBadge.style.background = currentTitle.color;
            
            // æ›´æ–°åˆ†æ•°
            document.getElementById('total-score').textContent = totalScore;
            
            // æ›´æ–°ç»éªŒæ¡
            const expPercent = (currentExp / expToNextLevel) * 100;
            document.getElementById('exp-fill').style.width = `${expPercent}%`;
            document.getElementById('exp-text').textContent = `${currentExp}/${expToNextLevel}`;
        }
        
        // æ¸²æŸ“å†å²è®°å½•
        function renderHistory() {
            const total = historyData.length;
            const correct = historyData.filter(h => h.isCorrect).length;
            const wrong = total - correct;
            const accuracy = total > 0 ? Math.round((correct / total) * 100) : 0;
            
            document.getElementById('history-total').textContent = total;
            document.getElementById('history-correct').textContent = correct;
            document.getElementById('history-wrong').textContent = wrong;
            document.getElementById('history-accuracy').textContent = accuracy + '%';
            
            const list = document.getElementById('history-list');
            
            if (historyData.length === 0) {
                list.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ“‹</div>
                        <div class="empty-state-text">æš‚æ— ç»ƒä¹ è®°å½•</div>
                    </div>
                `;
                return;
            }
            
            list.innerHTML = historyData.slice(0, 50).map(record => {
                const time = new Date(record.timestamp);
                const timeStr = `${time.getMonth() + 1}/${time.getDate()} ${time.getHours()}:${String(time.getMinutes()).padStart(2, '0')}`;
                
                return `
                    <div class="history-item">
                        <div class="history-question">${record.question}</div>
                        <div class="history-result">
                            <div class="history-answer">ä½ : ${record.userAnswer} | ç­”æ¡ˆ: ${record.correctAnswer}</div>
                            <span class="history-status ${record.isCorrect ? 'correct' : 'wrong'}">
                                ${record.isCorrect ? 'âœ“ æ­£ç¡®' : 'âœ— é”™è¯¯'}
                            </span>
                            <div class="history-time">${timeStr}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // æ¸²æŸ“è–„å¼±ç‚¹åˆ†æ
        function renderWeakness() {
            const chart = document.getElementById('weakness-chart');
            const tipsCard = document.getElementById('tips-card');
            const tipsList = document.getElementById('tips-list');
            
            const typeNames = {
                addition: 'åŠ æ³•',
                subtraction: 'å‡æ³•',
                multiplication: 'ä¹˜æ³•',
                division: 'é™¤æ³•'
            };
            
            const typesWithData = Object.keys(weaknessData).filter(type => 
                type !== 'mixed' && weaknessData[type].total > 0
            );
            
            if (typesWithData.length === 0) {
                chart.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ“Š</div>
                        <div class="empty-state-text">æš‚æ— è¶³å¤Ÿæ•°æ®è¿›è¡Œåˆ†æ<br>è¯·å…ˆå®Œæˆä¸€äº›ç»ƒä¹ </div>
                    </div>
                `;
                tipsCard.style.display = 'none';
                return;
            }
            
            const weaknessStats = typesWithData.map(type => {
                const data = weaknessData[type];
                const errorRate = data.total > 0 ? (data.wrong / data.total) : 0;
                return { type, ...data, errorRate };
            }).sort((a, b) => b.errorRate - a.errorRate);
            
            const maxErrorRate = Math.max(...weaknessStats.map(s => s.errorRate));
            
            chart.innerHTML = weaknessStats.map(stat => {
                const percentage = maxErrorRate > 0 ? (stat.errorRate / maxErrorRate) * 100 : 0;
                let level = 'low';
                if (stat.errorRate > 0.5) level = 'high';
                else if (stat.errorRate > 0.3) level = 'medium';
                
                return `
                    <div class="weakness-item">
                        <div class="weakness-label">${typeNames[stat.type]}</div>
                        <div class="weakness-bar">
                            <div class="weakness-fill ${level}" style="width: ${percentage}%"></div>
                        </div>
                        <div class="weakness-value">${(stat.errorRate * 100).toFixed(0)}%</div>
                    </div>
                `;
            }).join('');
            
            const tips = [];
            weaknessStats.forEach(stat => {
                if (stat.errorRate > 0.3) {
                    switch(stat.type) {
                        case 'addition':
                            tips.push('åŠ æ³•éœ€è¦å¤šç»ƒä¹ è¿›ä½è®¡ç®—');
                            break;
                        case 'subtraction':
                            tips.push('å‡æ³•éœ€è¦å¤šç»ƒä¹ é€€ä½è®¡ç®—');
                            break;
                        case 'multiplication':
                            tips.push('å»ºè®®ç†ŸèƒŒä¹˜æ³•å£è¯€è¡¨');
                            break;
                        case 'division':
                            tips.push('é™¤æ³•éœ€è¦ç†è§£ä¹˜æ³•é€†è¿ç®—');
                            break;
                    }
                }
            });
            
            if (tips.length > 0) {
                tipsList.innerHTML = tips.map(tip => `<li>${tip}</li>`).join('');
                tipsCard.style.display = 'block';
            } else {
                tipsList.innerHTML = '<li>ğŸ‰ è¡¨ç°ä¸é”™ï¼ç»§ç»­ä¿æŒï¼</li>';
                tipsCard.style.display = 'block';
            }
        }
        
        // æ˜¾ç¤ºä¸‰è¿å‡»å¥–åŠ±åŠ¨ç”»
        function showBonusAnimation() {
            // åˆ›å»ºæ˜Ÿæ˜Ÿå…ƒç´ 
            const star = document.createElement('div');
            star.className = 'star-animation';
            star.innerHTML = 'â­â­â­';
            document.body.appendChild(star);
            
            // 1ç§’åç§»é™¤
            setTimeout(() => {
                star.remove();
            }, 1000);
        }
        
        // æ˜¾ç¤ºå‡çº§åŠ¨ç”»
        function showLevelUpAnimation(levelName) {
            // åˆ›å»ºæ­å–œå‡çº§å¼¹çª—
            const congratsModal = document.createElement('div');
            congratsModal.className = 'congrats-modal';
            congratsModal.innerHTML = `
                <div class="congrats-content">
                    <div class="congrats-icon">ğŸ‰</div>
                    <div class="congrats-title">æ­å–œå‡çº§ï¼</div>
                    <div class="congrats-message">ä½ å·²ç»æˆåŠŸå‡çº§åˆ°${levelName}éš¾åº¦</div>
                    <div class="congrats-encourage">ç»§ç»­åŠ æ²¹ï¼ŒæŒ‘æˆ˜æ›´é«˜éš¾åº¦ï¼</div>
                    <button class="congrats-btn" onclick="this.closest('.congrats-modal').remove()">å¤ªæ£’äº†ï¼</button>
                </div>
            `;
            document.body.appendChild(congratsModal);

            // åˆ›å»ºå‡çº§æç¤ºå…ƒç´ 
            const levelUp = document.createElement('div');
            levelUp.className = 'level-up-animation';
            levelUp.innerHTML = `ğŸŠ å‡çº§åˆ°${levelName}éš¾åº¦ï¼ğŸŠ`;
            document.body.appendChild(levelUp);

            // æ’­æ”¾å‡çº§éŸ³æ•ˆï¼ˆä½¿ç”¨æ›´æ¬¢å¿«çš„éŸ³æ•ˆï¼‰
            const levelUpSound = new Audio('https://assets.mixkit.co/active_storage/sfx/1435/1435-preview.mp3');
            levelUpSound.volume = 0.6;
            levelUpSound.play().catch(e => console.log('å‡çº§éŸ³æ•ˆæ’­æ”¾å¤±è´¥:', e));

            // 2ç§’åç§»é™¤å‡çº§åŠ¨ç”»
            setTimeout(() => {
                levelUp.remove();
            }, 2000);
        }
        
        // æ›´æ–°éš¾åº¦æŒ‰é’®æ˜¾ç¤º
        function updateDifficultyButtons() {
            const buttons = document.querySelectorAll('.difficulty-btn');
            buttons.forEach(btn => {
                btn.classList.remove('active');
                if (btn.textContent === 'ç®€å•' && currentDifficulty === 'easy') {
                    btn.classList.add('active');
                } else if (btn.textContent === 'ä¸­ç­‰' && currentDifficulty === 'medium') {
                    btn.classList.add('active');
                } else if (btn.textContent === 'å›°éš¾' && currentDifficulty === 'hard') {
                    btn.classList.add('active');
                }
            });
        }
        
        // ğŸ† æ£€æŸ¥æˆå°±
        function checkAchievement(key) {
            if (achievements[key] && !achievements[key].unlocked) {
                achievements[key].unlocked = true;
                localStorage.setItem('mathAchievements', JSON.stringify(achievements));
                showAchievementUnlock(achievements[key]);
            }
        }
        
        // ğŸ‰ æ˜¾ç¤ºæˆå°±è§£é”åŠ¨ç”»
        function showAchievementUnlock(achievement) {
            const achievementDiv = document.createElement('div');
            achievementDiv.className = 'achievement-unlock';
            achievementDiv.innerHTML = `
                <div class="achievement-icon">ğŸ†</div>
                <div class="achievement-text">
                    <div class="achievement-title">è§£é”æˆå°±ï¼</div>
                    <div class="achievement-name">${achievement.name}</div>
                    <div class="achievement-desc">${achievement.desc}</div>
                </div>
            `;
            document.body.appendChild(achievementDiv);
            
            // æ’­æ”¾æˆå°±éŸ³æ•ˆ
            const achievementSound = new Audio('https://assets.mixkit.co/active_storage/sfx/1435/1435-preview.mp3');
            achievementSound.volume = 0.5;
            achievementSound.play().catch(e => console.log('æˆå°±éŸ³æ•ˆæ’­æ”¾å¤±è´¥:', e));
            
            setTimeout(() => {
                achievementDiv.remove();
            }, 3000);
        }
        
        // ğŸ’¯ æ˜¾ç¤ºå¾—åˆ†åŠ¨ç”»
        function showScoreAnimation(points, exp) {
            const scoreDiv = document.createElement('div');
            scoreDiv.className = 'score-popup';
            scoreDiv.innerHTML = `+${points}åˆ†`;
            document.body.appendChild(scoreDiv);
            
            setTimeout(() => {
                scoreDiv.remove();
            }, 1000);
        }
        
        // ğŸ® è·å–å½“å‰ç§°å·
        function getCurrentTitle() {
            let title = titles[0];
            for (let i = titles.length - 1; i >= 0; i--) {
                if (currentLevel >= titles[i].level) {
                    title = titles[i];
                    break;
                }
            }
            return title;
        }
        
        // æ¸…ç©ºå†å²
        function clearHistory() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å†å²è®°å½•å—ï¼Ÿ')) {
                historyData = [];
                weaknessData = {
                    addition: { total: 0, wrong: 0 },
                    subtraction: { total: 0, wrong: 0 },
                    multiplication: { total: 0, wrong: 0 },
                    division: { total: 0, wrong: 0 },
                    mixed: { total: 0, wrong: 0 }
                };
                localStorage.removeItem('mathHistory');
                localStorage.removeItem('mathWeakness');
                updateStats();
                renderHistory();
                renderWeakness();
            }
        }
        
        // æ˜¾ç¤ºåˆ†äº«å¼•å¯¼
        function showShareGuide() {
            document.getElementById('share-guide').classList.add('show');
        }
        
        // éšè—åˆ†äº«å¼•å¯¼
        function hideShareGuide() {
            document.getElementById('share-guide').classList.remove('show');
        }
        
        // é”®ç›˜æ”¯æŒï¼ˆä»…PCç«¯ï¼‰
        document.addEventListener('keydown', function(e) {
            if (!isAnswering) return;
            
            // æ£€æµ‹æ˜¯å¦ä¸ºç§»åŠ¨è®¾å¤‡ï¼Œå¦‚æœæ˜¯åˆ™ä¸å¤„ç†é”®ç›˜äº‹ä»¶ï¼ˆé¿å…é‡å¤è¾“å…¥ï¼‰
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            if (isMobile) return;
            
            if (e.key >= '0' && e.key <= '9') {
                inputNumber(e.key);
            } else if (e.key === 'Enter') {
                submitAnswer();
            } else if (e.key === 'Backspace') {
                const input = document.getElementById('answer-input');
                input.value = input.value.slice(0, -1);
            } else if (e.key === 'Escape') {
                clearInput();
            }
        });
        
        // é˜²æ­¢é¡µé¢æ»šåŠ¨å›å¼¹ï¼ˆiOSï¼‰
        document.body.addEventListener('touchmove', function(e) {
            if (e.target.closest('.history-list')) {
                return;
            }
            e.preventDefault();
        }, { passive: false });
        
        // GitHub Pages é”™è¯¯é¡µé¢é‡å®šå‘
        if (isGitHubPages && window.location.pathname !== '/math-practice/' && 
            window.location.pathname.indexOf('/math-practice/') !== 0) {
            // å·²ç»æ˜¯æ­£ç¡®è·¯å¾„ï¼Œä¸åšå¤„ç†
        }
    </script>
</body>
</html>