<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="format-detection" content="telephone=no">
    <meta name="description" content="Â∞èÂ≠¶‰∏âÂπ¥Á∫ßÊï∞Â≠¶Êô∫ËÉΩÁªÉ‰π†Á≥ªÁªü - ÂæÆ‰ø°H5">
    <meta name="keywords" content="Â∞èÂ≠¶Êï∞Â≠¶,Êï∞Â≠¶ÁªÉ‰π†,‰∏âÂπ¥Á∫ßÊï∞Â≠¶,Âè£ÁÆóÁªÉ‰π†">
    
    <!-- ÂæÆ‰ø°ÂàÜ‰∫´ÈÖçÁΩÆ -->
    <meta property="og:title" content="üéì Â∞èÂ≠¶‰∏âÂπ¥Á∫ßÊï∞Â≠¶ÁªÉ‰π†">
    <meta property="og:description" content="Êô∫ËÉΩÂá∫È¢òÔºåËá™Âä®ÂàÜÊûêËñÑÂº±ÁÇπÔºåËÆ©Êï∞Â≠¶Â≠¶‰π†Êõ¥È´òÊïàÔºÅ">
    <meta property="og:image" content="https://via.placeholder.com/300x300/667eea/ffffff?text=Êï∞Â≠¶ÁªÉ‰π†">
    
    <!-- Á¶ÅÊ≠¢ÁºìÂ≠òÔºàÂºÄÂèëÈò∂ÊÆµÔºâ -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    
    <title>üéì ‰∏âÂπ¥Á∫ßÊï∞Â≠¶ÁªÉ‰π†</title>
    
    <!-- GitHub Pages Âü∫Á°ÄË∑ØÂæÑËÆæÁΩÆ -->
    <base href="https://hanjiang6608.github.io/math-practice/">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'Helvetica Neue', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            min-height: 100dvh;
            padding: 5px;
            padding-bottom: env(safe-area-inset-bottom);
            -webkit-font-smoothing: antialiased;
        }
        
        .container {
            max-width: 480px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
            min-height: calc(100vh - 10px);
            min-height: calc(100dvh - 10px);
            display: flex;
            flex-direction: column;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px;
            text-align: center;
            position: relative;
        }
        
        .header h1 {
            font-size: 20px;
            margin-bottom: 3px;
            font-weight: 600;
        }
        
        .header .subtitle {
            font-size: 12px;
            opacity: 0.9;
        }
        
        .share-btn {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 12px;
            cursor: pointer;
        }
        
        .nav-tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
            flex-shrink: 0;
        }
        
        .nav-tab {
            flex: 1;
            padding: 12px 10px;
            text-align: center;
            font-size: 14px;
            color: #6c757d;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
            background: transparent;
            font-weight: 500;
        }
        
        .nav-tab.active {
            color: #667eea;
            font-weight: 600;
            background: white;
            position: relative;
        }
        
        .nav-tab.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 20%;
            right: 20%;
            height: 3px;
            background: #667eea;
            border-radius: 3px 3px 0 0;
        }
        
        .content {
            flex: 1;
            padding: 10px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .page {
            display: none;
            height: 100%;
        }
        
        .page.active {
            display: block;
        }
        
        /* ÁªÉ‰π†È°µÈù¢Ê†∑Âºè */
        
        /* üéÆ Ê∏∏ÊàèÂåñ‰ø°ÊÅØÊ†è */
        .game-stats {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 12px;
            padding: 12px;
            margin-bottom: 10px;
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        
        .level-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .level-badge {
            background: rgba(255,255,255,0.2);
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 700;
        }
        
        .title-badge {
            background: rgba(255,255,255,0.25);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
        }
        
        .score-info {
            text-align: center;
            margin-bottom: 8px;
        }
        
        .score-display {
            font-size: 18px;
            font-weight: 700;
        }
        
        .exp-bar-container {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .exp-bar {
            flex: 1;
            height: 8px;
            background: rgba(255,255,255,0.2);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .exp-fill {
            height: 100%;
            background: linear-gradient(90deg, #ffd43b, #fcc419);
            border-radius: 4px;
            transition: width 0.5s ease;
        }
        
        .exp-text {
            font-size: 11px;
            min-width: 50px;
            text-align: right;
        }
        
        .stats-bar {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 6px;
            margin-bottom: 10px;
            padding: 8px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 10px;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-value {
            font-size: 20px;
            font-weight: 700;
            color: #667eea;
            line-height: 1;
        }
        
        .stat-label {
            font-size: 11px;
            color: #6c757d;
            margin-top: 4px;
        }
        
        .difficulty-selector {
            margin-bottom: 10px;
        }
        
        .difficulty-selector label {
            display: block;
            margin-bottom: 6px;
            font-size: 12px;
            color: #495057;
            font-weight: 500;
        }
        
        .difficulty-btns {
            display: flex;
            gap: 8px;
        }
        
        .difficulty-btn {
            flex: 1;
            padding: 8px;
            border: 2px solid #e9ecef;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s;
            font-weight: 500;
        }
        
        .difficulty-btn.active {
            border-color: #667eea;
            background: #667eea;
            color: white;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
        
        .question-card {
            background: #fff;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 15px 12px;
            text-align: center;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }
        
        .question-card.correct {
            border-color: #28a745;
            background: #d4edda;
            animation: correctPulse 0.5s ease;
        }
        
        .question-card.wrong {
            border-color: #dc3545;
            background: #f8d7da;
            animation: shake 0.5s ease;
        }
        
        @keyframes correctPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        .question-text {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 10px;
            color: #212529;
            margin-bottom: 15px;
            font-family: 'Courier New', monospace;
        }
        
        .answer-input {
            width: 100%;
            padding: 10px;
            font-size: 24px;
            text-align: center;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            outline: none;
            transition: all 0.3s;
            background: #f8f9fa;
            font-weight: 600;
            color: #495057;
            letter-spacing: 2px;
        }
        
        .answer-input:focus {
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
        }
        
        .btn {
            width: 100%;
            padding: 12px;
            font-size: 16px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            -webkit-tap-highlight-color: rgba(0,0,0,0.1);
        }
        
        .btn:active {
            transform: scale(0.98);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn-primary:active {
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
            margin-top: 10px;
        }
        
        .btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }
        
        .feedback {
            margin-top: 8px;
            padding: 8px;
            border-radius: 8px;
            text-align: center;
            font-size: 14px;
            display: none;
            font-weight: 500;
        }
        
        .feedback.show {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .feedback.success {
            background: #d4edda;
            color: #155724;
        }
        
        .feedback.error {
            background: #f8d7da;
            color: #721c24;
        }
        
        /* Êï∞Â≠óÈîÆÁõò */
        .number-pad {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 15px;
        }
        
        .num-btn {
            padding: 18px;
            font-size: 24px;
            border: none;
            background: #f8f9fa;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.15s;
            font-weight: 600;
            color: #495057;
            -webkit-tap-highlight-color: rgba(0,0,0,0.1);
        }
        
        .num-btn:active {
            background: #667eea;
            color: white;
            transform: scale(0.95);
        }
        
        .num-btn.clear {
            background: #ff6b6b;
            color: white;
        }
        
        .num-btn.clear:active {
            background: #ee5a5a;
        }
        
        .num-btn.submit {
            background: #51cf66;
            color: white;
        }
        
        .num-btn.submit:active {
            background: #40c057;
        }
        
        /* ÂéÜÂè≤ËÆ∞ÂΩïÈ°µÈù¢Ê†∑Âºè */
        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .history-header h2 {
            font-size: 17px;
            color: #212529;
            font-weight: 600;
        }
        
        .clear-btn {
            padding: 8px 14px;
            font-size: 12px;
            background: #ff6b6b;
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        .clear-btn:active {
            background: #ee5a5a;
            transform: scale(0.95);
        }
        
        .summary-cards {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .summary-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 15px;
            border-radius: 12px;
            text-align: center;
        }
        
        .summary-card .number {
            font-size: 26px;
            font-weight: 700;
            color: #667eea;
        }
        
        .summary-card .label {
            font-size: 12px;
            color: #6c757d;
            margin-top: 4px;
            font-weight: 500;
        }
        
        .history-list {
            max-height: calc(100vh - 350px);
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            padding-right: 5px;
        }
        
        .history-list::-webkit-scrollbar {
            width: 4px;
        }
        
        .history-list::-webkit-scrollbar-thumb {
            background: #dee2e6;
            border-radius: 2px;
        }
        
        .history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            border-bottom: 1px solid #f1f3f5;
            background: white;
            transition: background 0.2s;
        }
        
        .history-item:active {
            background: #f8f9fa;
        }
        
        .history-item:last-child {
            border-bottom: none;
        }
        
        .history-question {
            font-size: 16px;
            font-weight: 600;
            color: #212529;
            font-family: 'Courier New', monospace;
        }
        
        .history-result {
            text-align: right;
        }
        
        .history-answer {
            font-size: 13px;
            color: #6c757d;
            margin-bottom: 3px;
        }
        
        .history-status {
            font-size: 11px;
            font-weight: 600;
            padding: 3px 10px;
            border-radius: 20px;
            display: inline-block;
        }
        
        .history-status.correct {
            background: #d3f9d8;
            color: #2b8a3e;
        }
        
        .history-status.wrong {
            background: #ffe3e3;
            color: #c92a2a;
        }
        
        .history-time {
            font-size: 10px;
            color: #adb5bd;
            margin-top: 3px;
        }
        
        /* ÈîôÈ¢òÁªüËÆ°È°µÈù¢Ê†∑Âºè */
        .weakness-header {
            margin-bottom: 15px;
        }
        
        .weakness-header h2 {
            font-size: 17px;
            color: #212529;
            margin-bottom: 5px;
            font-weight: 600;
        }
        
        .weakness-header p {
            font-size: 12px;
            color: #6c757d;
            line-height: 1.5;
        }
        
        .weakness-chart {
            margin-bottom: 15px;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 12px;
        }
        
        .weakness-item {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .weakness-item:last-child {
            margin-bottom: 0;
        }
        
        .weakness-label {
            width: 50px;
            font-size: 14px;
            color: #495057;
            font-weight: 500;
        }
        
        .weakness-bar {
            flex: 1;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 0 10px;
        }
        
        .weakness-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s ease;
            position: relative;
        }
        
        .weakness-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, rgba(255,255,255,0) 0%, rgba(255,255,255,0.3) 50%, rgba(255,255,255,0) 100%);
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        .weakness-fill.high {
            background: linear-gradient(90deg, #ff6b6b, #fa5252);
        }
        
        .weakness-fill.medium {
            background: linear-gradient(90deg, #ffd43b, #fab005);
        }
        
        .weakness-fill.low {
            background: linear-gradient(90deg, #51cf66, #40c057);
        }
        
        .weakness-value {
            width: 45px;
            font-size: 13px;
            text-align: right;
            font-weight: 600;
            color: #495057;
        }
        
        .tips-card {
            background: linear-gradient(135deg, #fff9db 0%, #ffec99 100%);
            border: 1px solid #ffd43b;
            border-radius: 12px;
            padding: 15px;
            margin-top: 15px;
        }
        
        .tips-card h3 {
            font-size: 14px;
            color: #e67700;
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .tips-card ul {
            list-style: none;
            padding-left: 0;
        }
        
        .tips-card li {
            font-size: 13px;
            color: #d9480f;
            padding: 6px 0;
            padding-left: 20px;
            position: relative;
            line-height: 1.5;
        }
        
        .tips-card li:before {
            content: "üí°";
            position: absolute;
            left: 0;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #adb5bd;
        }
        
        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 15px;
            opacity: 0.7;
        }
        
        .empty-state-text {
            font-size: 14px;
            line-height: 1.6;
        }

        /* ÂºÄÂßãÁïåÈù¢ */
        .start-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            z-index: 999;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            text-align: center;
            padding: 30px;
        }
        
        .start-screen.hidden {
            display: none;
        }
        
        .start-icon {
            font-size: 80px;
            margin-bottom: 20px;
        }
        
        .start-title {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 10px;
        }
        
        .start-subtitle {
            font-size: 16px;
            opacity: 0.9;
            margin-bottom: 40px;
        }
        
        .start-features {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            width: 100%;
            max-width: 300px;
            margin-bottom: 40px;
        }
        
        .feature-item {
            background: rgba(255,255,255,0.15);
            padding: 15px;
            border-radius: 12px;
            backdrop-filter: blur(10px);
        }
        
        .feature-icon {
            font-size: 24px;
            margin-bottom: 5px;
        }
        
        .feature-text {
            font-size: 12px;
        }
        
        .start-btn {
            background: white;
            color: #667eea;
            border: none;
            padding: 18px 50px;
            border-radius: 30px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: all 0.3s;
        }
        
        .start-btn:active {
            transform: scale(0.95);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        /* ÂàÜ‰∫´ÂºïÂØº */
        .guide-tip {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            display: none;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .guide-tip.show {
            display: flex;
        }
        
        .guide-content {
            background: white;
            border-radius: 16px;
            padding: 25px;
            text-align: center;
            max-width: 300px;
            animation: guidePop 0.3s ease;
        }
        
        @keyframes guidePop {
            0% { transform: scale(0.8); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .guide-arrow {
            font-size: 40px;
            margin-bottom: 15px;
            animation: arrowBounce 1s infinite;
        }
        
        @keyframes arrowBounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .guide-text {
            font-size: 15px;
            color: #495057;
            margin-bottom: 20px;
            line-height: 1.6;
        }
        
        .guide-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
        }

        /* ÂìçÂ∫îÂºè‰ºòÂåñ */
        @media (max-width: 380px) {
            .question-text {
                font-size: 30px;
            }
            
            .answer-input {
                font-size: 24px;
            }
            
            .num-btn {
                padding: 15px;
                font-size: 22px;
            }
        }

        /* ÂæÆ‰ø°ÊµèËßàÂô®ÈÄÇÈÖç */
        .wechat-browser .container {
            min-height: calc(100vh - 10px);
        }
        
        /* ÈîÆÁõòÂºπÂá∫Êó∂ÁöÑÈÄÇÈÖç */
        @media (max-height: 600px) {
            .header {
                padding: 8px;
            }
            .header h1 {
                font-size: 18px;
            }
            .question-text {
                font-size: 28px;
            }
            .answer-input {
                padding: 8px;
                font-size: 22px;
            }
            .btn {
                padding: 10px;
            }
        }
        
        /* ‰∏âËøûÂáªÂ•ñÂä±Âä®Áîª */
        .feedback.bonus {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            color: #d9480f;
            font-size: 18px;
            font-weight: 700;
            animation: bonusPulse 0.5s ease;
        }
        
        .bonus-text {
            display: inline-block;
            animation: bonusScale 0.5s ease;
        }
        
        @keyframes bonusPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        @keyframes bonusScale {
            0% { transform: scale(0.8); opacity: 0; }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); opacity: 1; }
        }
        
        /* ÊòüÊòüÂ•ñÂä±Âä®Áîª */
        .star-animation {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 60px;
            animation: starPop 1s ease forwards;
            z-index: 9999;
            pointer-events: none;
        }
        
        @keyframes starPop {
            0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
            50% { transform: translate(-50%, -50%) scale(1.5); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(1) translateY(-100px); opacity: 0; }
        }
        
        /* ÂçáÁ∫ßÂä®Áîª */
        .level-up-animation {
            position: fixed;
            top: 30%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 30px;
            border-radius: 15px;
            font-size: 20px;
            font-weight: 700;
            animation: levelUpPop 2s ease forwards;
            z-index: 10000;
            pointer-events: none;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.5);
        }
        
        @keyframes levelUpPop {
            0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
            20% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
            80% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(1) translateY(-50px); opacity: 0; }
        }
        
        /* ÂæóÂàÜÂºπÂá∫Âä®Áîª */
        .score-popup {
            position: fixed;
            top: 40%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #ffd43b;
            font-size: 36px;
            font-weight: 900;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            animation: scoreFloat 1s ease forwards;
            z-index: 9999;
            pointer-events: none;
        }
        
        @keyframes scoreFloat {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
            30% { transform: translate(-50%, -50%) scale(1.3); opacity: 1; }
            100% { transform: translate(-50%, -150%) scale(1); opacity: 0; }
        }
        
        .score-text {
            color: #ffd43b;
            font-weight: 700;
        }
        
        /* ÊàêÂ∞±Ëß£ÈîÅÂä®Áîª */
        .achievement-unlock {
            position: fixed;
            top: 20%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #ffd43b 0%, #fcc419 100%);
            color: #333;
            padding: 15px 20px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            gap: 12px;
            animation: achievementPop 3s ease forwards;
            z-index: 10001;
            pointer-events: none;
            box-shadow: 0 10px 30px rgba(255, 212, 59, 0.5);
            min-width: 250px;
        }
        
        .achievement-icon {
            font-size: 40px;
        }
        
        .achievement-text {
            text-align: left;
        }
        
        .achievement-title {
            font-size: 12px;
            opacity: 0.8;
            margin-bottom: 2px;
        }
        
        .achievement-name {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 2px;
        }
        
        .achievement-desc {
            font-size: 11px;
            opacity: 0.7;
        }
        
        @keyframes achievementPop {
            0% { transform: translate(-50%, -50%) scale(0) rotate(-10deg); opacity: 0; }
            15% { transform: translate(-50%, -50%) scale(1.1) rotate(2deg); opacity: 1; }
            20% { transform: translate(-50%, -50%) scale(1) rotate(0deg); }
            85% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
            100% { transform: translate(-50%, -100%) scale(0.8); opacity: 0; }
        }
    </style>
</head>
<body>
    <!-- ÂºÄÂßãÁïåÈù¢ -->
    <div class="start-screen" id="start-screen">
        <div class="start-icon">üéì</div>
        <div class="start-title">Êï∞Â≠¶Â∞èËææ‰∫∫</div>
        <div class="start-subtitle">‰∏âÂπ¥Á∫ßÊô∫ËÉΩÁªÉ‰π†Á≥ªÁªü</div>
        <div class="start-features">
            <div class="feature-item">
                <div class="feature-icon">üß†</div>
                <div class="feature-text">Êô∫ËÉΩÂá∫È¢ò</div>
            </div>
            <div class="feature-item">
                <div class="feature-icon">üìä</div>
                <div class="feature-text">ÈîôÈ¢òÂàÜÊûê</div>
            </div>
            <div class="feature-item">
                <div class="feature-icon">üéØ</div>
                <div class="feature-text">ÈíàÂØπÁªÉ‰π†</div>
            </div>
            <div class="feature-item">
                <div class="feature-icon">üèÜ</div>
                <div class="feature-text">ÊàêÁª©ËÆ∞ÂΩï</div>
            </div>
        </div>
        <button class="start-btn" onclick="startApp()">ÂºÄÂßãÂ≠¶‰π†</button>
    </div>

    <!-- ÂàÜ‰∫´ÂºïÂØº -->
    <div class="guide-tip" id="share-guide">
        <div class="guide-content">
            <div class="guide-arrow">üëÜ</div>
            <div class="guide-text">ÁÇπÂáªÂè≥‰∏äËßíËèúÂçï<br>ÈÄâÊã©„ÄåÂèëÈÄÅÁªôÊúãÂèã„Äç<br>‰∏ÄËµ∑ÁªÉ‰π†Êõ¥ÊúâË∂£ÔºÅ</div>
            <button class="guide-btn" onclick="hideShareGuide()">ÊàëÁü•ÈÅì‰∫Ü</button>
        </div>
    </div>

    <div class="container">
        <div class="header">
            <h1>üéì Êï∞Â≠¶ÁªÉ‰π†</h1>
            <div class="subtitle">Êô∫ËÉΩÂá∫È¢ò ¬∑ ÈíàÂØπËÆ≠ÁªÉ</div>
            <button class="share-btn" onclick="showShareGuide()">ÂàÜ‰∫´</button>
        </div>
        
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchPage('practice')">ÁªÉ‰π†</button>
            <button class="nav-tab" onclick="switchPage('history')">ËÆ∞ÂΩï</button>
            <button class="nav-tab" onclick="switchPage('weakness')">ÂàÜÊûê</button>
        </div>
        
        <div class="content">
            <!-- ÁªÉ‰π†È°µÈù¢ -->
            <div id="practice-page" class="page active">
                <!-- üéÆ Ê∏∏ÊàèÂåñ‰ø°ÊÅØÊ†è -->
                <div class="game-stats">
                    <div class="level-info">
                        <div class="level-badge" id="level-badge">Lv.1</div>
                        <div class="title-badge" id="title-badge">üå± Êï∞Â≠¶Êñ∞Êâã</div>
                    </div>
                    <div class="score-info">
                        <div class="score-display">üèÜ <span id="total-score">0</span> ÂàÜ</div>
                    </div>
                    <div class="exp-bar-container">
                        <div class="exp-bar" id="exp-bar">
                            <div class="exp-fill" id="exp-fill"></div>
                        </div>
                        <div class="exp-text" id="exp-text">0/100</div>
                    </div>
                </div>
                
                <div class="stats-bar">
                    <div class="stat-item">
                        <div class="stat-value" id="total-count">0</div>
                        <div class="stat-label">ÊÄªÈ¢òÊï∞</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="correct-count">0</div>
                        <div class="stat-label">Ê≠£Á°Æ</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="wrong-count">0</div>
                        <div class="stat-label">ÈîôËØØ</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="accuracy">0%</div>
                        <div class="stat-label">Ê≠£Á°ÆÁéá</div>
                    </div>
                </div>
                
                <div class="difficulty-selector">
                    <label>ÈÄâÊã©ÈöæÂ∫¶Ôºö</label>
                    <div class="difficulty-btns">
                        <button class="difficulty-btn active" onclick="setDifficulty('easy')">ÁÆÄÂçï</button>
                        <button class="difficulty-btn" onclick="setDifficulty('medium')">‰∏≠Á≠â</button>
                        <button class="difficulty-btn" onclick="setDifficulty('hard')">Âõ∞Èöæ</button>
                    </div>
                </div>
                
                <div class="question-card" id="question-card">
                    <div class="question-text" id="question-text">ÁÇπÂáªÂºÄÂßãÁªÉ‰π†</div>
                    <input type="number" 
                           class="answer-input" 
                           id="answer-input" 
                           placeholder="ËæìÂÖ•Á≠îÊ°à" 
                           inputmode="numeric"
                           pattern="[0-9]*"
                           autocomplete="off">
                    <div class="feedback" id="feedback"></div>
                </div>
                
                <button class="btn btn-primary" id="action-btn" onclick="handleAction()">ÂºÄÂßãÁªÉ‰π†</button>
                
                <!-- Êï∞Â≠óÈîÆÁõòÂ∑≤Á¶ÅÁî®Ôºå‰ΩøÁî®Á≥ªÁªüÈîÆÁõò -->
                <div class="number-pad" id="number-pad" style="display: none;"></div>
            </div>
            
            <!-- ÂéÜÂè≤ËÆ∞ÂΩïÈ°µÈù¢ -->
            <div id="history-page" class="page">
                <div class="history-header">
                    <h2>üìä ÁªÉ‰π†ËÆ∞ÂΩï</h2>
                    <button class="clear-btn" onclick="clearHistory()">Ê∏ÖÁ©∫</button>
                </div>
                
                <div class="summary-cards">
                    <div class="summary-card">
                        <div class="number" id="history-total">0</div>
                        <div class="label">ÊÄªÈ¢òÊï∞</div>
                    </div>
                    <div class="summary-card">
                        <div class="number" id="history-correct">0</div>
                        <div class="label">Ê≠£Á°Æ</div>
                    </div>
                    <div class="summary-card">
                        <div class="number" id="history-wrong">0</div>
                        <div class="label">ÈîôËØØ</div>
                    </div>
                    <div class="summary-card">
                        <div class="number" id="history-accuracy">0%</div>
                        <div class="label">Ê≠£Á°ÆÁéá</div>
                    </div>
                </div>
                
                <div class="history-list" id="history-list">
                    <div class="empty-state">
                        <div class="empty-state-icon">üìã</div>
                        <div class="empty-state-text">ÊöÇÊó†ÁªÉ‰π†ËÆ∞ÂΩï</div>
                    </div>
                </div>
            </div>
            
            <!-- ÈîôÈ¢òÂàÜÊûêÈ°µÈù¢ -->
            <div id="weakness-page" class="page">
                <div class="weakness-header">
                    <h2>üîç ËñÑÂº±ÁÇπÂàÜÊûê</h2>
                    <p>Á≥ªÁªüÊ†πÊçÆÈîôÈ¢òÁ±ªÂûãËá™Âä®Ë∞ÉÊï¥Âá∫È¢òÊØî‰æã<br>ÈîôËØØË∂äÂ§öÔºåËØ•Á±ªÂûãÈ¢òÁõÆÂá∫Áé∞Ê¶ÇÁéáË∂äÈ´ò</p>
                </div>
                
                <div class="weakness-chart" id="weakness-chart">
                    <div class="empty-state">
                        <div class="empty-state-icon">üìä</div>
                        <div class="empty-state-text">ÊöÇÊó†Ë∂≥Â§üÊï∞ÊçÆËøõË°åÂàÜÊûê<br>ËØ∑ÂÖàÂÆåÊàê‰∏Ä‰∫õÁªÉ‰π†</div>
                    </div>
                </div>
                
                <div class="tips-card" id="tips-card" style="display: none;">
                    <h3>üí° Â≠¶‰π†Âª∫ËÆÆ</h3>
                    <ul id="tips-list"></ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Ê£ÄÊµãÊòØÂê¶Âú®GitHub PagesÁéØÂ¢É
        const isGitHubPages = window.location.hostname.includes('github.io');
        
        // Êï∞ÊçÆÂ≠òÂÇ®
        let historyData = JSON.parse(localStorage.getItem('mathHistory')) || [];
        let weaknessData = JSON.parse(localStorage.getItem('mathWeakness')) || {
            addition: { total: 0, wrong: 0 },
            subtraction: { total: 0, wrong: 0 },
            multiplication: { total: 0, wrong: 0 },
            division: { total: 0, wrong: 0 },
            mixed: { total: 0, wrong: 0 }
        };
        
        let currentQuestion = null;
        let isAnswering = false;
        let currentDifficulty = 'easy';
        let consecutiveCorrect = 0; // ËøûÁª≠Á≠îÂØπËÆ°Êï∞Âô®
        
        // ÁªÑÈ¢òËÆæÁΩÆ
        const GROUP_SIZE = 10; // ÊØèÁªÑ10ÈÅìÈ¢ò
        let currentGroupCount = 0; // ÂΩìÂâçÁªÑÂÜÖÈ¢òÁõÆËÆ°Êï∞
        let groupCorrectCount = 0; // ÂΩìÂâçÁªÑÂÜÖÊ≠£Á°ÆÈ¢òÊï∞
        
        // üéÆ Ê∏∏ÊàèÂåñÁ≥ªÁªü
        let totalScore = parseInt(localStorage.getItem('mathTotalScore')) || 0;
        let currentLevel = parseInt(localStorage.getItem('mathLevel')) || 1;
        let currentExp = parseInt(localStorage.getItem('mathExp')) || 0;
        let expToNextLevel = currentLevel * 100;
        
        // Áß∞Âè∑Á≥ªÁªü
        const titles = [
            { level: 1, title: 'üå± Êï∞Â≠¶Êñ∞Êâã', color: '#51cf66' },
            { level: 5, title: 'üìö ËÆ°ÁÆóÂ≠¶Âæí', color: '#339af0' },
            { level: 10, title: '‚ö° ÈÄüÁÆóËææ‰∫∫', color: '#ff6b6b' },
            { level: 20, title: 'üèÜ Êï∞Â≠¶Â§ßÂ∏à', color: '#ffd43b' },
            { level: 30, title: 'üëë Êï∞Â≠¶ÁéãËÄÖ', color: '#a855f7' }
        ];
        
        // ÊàêÂ∞±Á≥ªÁªü
        const achievements = JSON.parse(localStorage.getItem('mathAchievements')) || {
            'first_correct': { name: 'üéØ ÂàùÂá∫ËåÖÂ∫ê', desc: 'È¶ñÊ¨°Á≠îÂØπÈ¢òÁõÆ', unlocked: false },
            'streak_5': { name: 'üî• ËøûÂáªÈ´òÊâã', desc: 'ËøûÁª≠Á≠îÂØπ5È¢ò', unlocked: false },
            'streak_10': { name: '‚ö° ÂÆåÁæéËøûÂáª', desc: 'ËøûÁª≠Á≠îÂØπ10È¢ò', unlocked: false },
            'speed_demon': { name: 'üí® Èó™Áîµ‰æ†', desc: '3ÁßíÂÜÖÁ≠îÂØπ‰∏ÄÈ¢ò', unlocked: false },
            'group_perfect': { name: 'üíØ ÂÖ®ÂØπÂ§ßÂ∏à', desc: '‰∏ÄÁªÑÈ¢òÁõÆÂÖ®ÂØπ', unlocked: false },
            'level_5': { name: 'üìà ÂçáÁ∫ßËææ‰∫∫', desc: 'ËææÂà∞5Á∫ß', unlocked: false },
            'level_10': { name: 'üéì Êï∞Â≠¶‰∏ìÂÆ∂', desc: 'ËææÂà∞10Á∫ß', unlocked: false }
        };
        
        // ËÆ°Êó∂Á≥ªÁªü
        let questionStartTime = 0;
        let bestTime = parseInt(localStorage.getItem('mathBestTime')) || 999;
        
        // Èü≥ÊïàËÆæÁΩÆÔºàË∂ÖÁ∫ßÁéõ‰∏ΩÈáëÂ∏ÅÂ£∞Ôºâ
        const correctSound = new Audio('https://assets.mixkit.co/active_storage/sfx/2000/2000-preview.mp3');
        correctSound.volume = 0.5; // 50%Èü≥Èáè
        
        // ÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            // Ê£ÄÊµãÂæÆ‰ø°ÊµèËßàÂô®
            const isWechat = /MicroMessenger/i.test(navigator.userAgent);
            if (isWechat) {
                document.body.classList.add('wechat-browser');
            }
            
            // ÁõëÂê¨ËæìÂÖ•Ê°ÜËæìÂÖ•‰∫ã‰ª∂ÔºåÂÆûÁé∞Ëá™Âä®Êèê‰∫§
            const answerInput = document.getElementById('answer-input');
            answerInput.addEventListener('input', function(e) {
                if (!isAnswering || !currentQuestion) return;
                
                const inputValue = e.target.value;
                const correctAnswer = currentQuestion.answer;
                const answerLength = String(correctAnswer).length;
                
                // ÂΩìËæìÂÖ•‰ΩçÊï∞Á≠â‰∫éÁ≠îÊ°à‰ΩçÊï∞Êó∂ÔºåËá™Âä®Êèê‰∫§
                if (inputValue.length === answerLength) {
                    // Âª∂Ëøü100msÔºåËÆ©Áî®Êà∑ÁúãÂà∞ËæìÂÖ•ÁöÑÊï∞Â≠ó
                    setTimeout(() => {
                        submitAnswer();
                    }, 100);
                }
            });
            
            updateStats();
            updateGameStats(); // ÂàùÂßãÂåñÊ∏∏ÊàèÂåñUI
        });
        
        // ÂºÄÂßãÂ∫îÁî®
        function startApp() {
            document.getElementById('start-screen').classList.add('hidden');
            updateStats();
            updateGameStats();
            renderHistory();
            renderWeakness();
        }
        
        // È°µÈù¢ÂàáÊç¢
        function switchPage(page) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            
            document.getElementById(page + '-page').classList.add('active');
            event.target.classList.add('active');
            
            if (page === 'history') {
                renderHistory();
            } else if (page === 'weakness') {
                renderWeakness();
            }
        }
        
        // ËÆæÁΩÆÈöæÂ∫¶
        function setDifficulty(level) {
            currentDifficulty = level;
            document.querySelectorAll('.difficulty-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
        }
        
        // ÁîüÊàêÈ¢òÁõÆ
        function generateQuestion() {
            const types = ['addition', 'subtraction', 'multiplication', 'division'];
            
            // ËÆ°ÁÆóÊùÉÈáç
            let weights = types.map(type => {
                const data = weaknessData[type];
                if (data.total === 0) return 1;
                const errorRate = data.wrong / data.total;
                return 0.3 + errorRate * 2;
            });
            
            // Ê†πÊçÆÈöæÂ∫¶Ë∞ÉÊï¥
            if (currentDifficulty === 'easy') {
                weights[0] *= 1.5;
                weights[1] *= 1.3;
            } else if (currentDifficulty === 'hard') {
                weights[2] *= 1.5;
                weights[3] *= 1.3;
            }
            
            // Âä†ÊùÉÈöèÊú∫ÈÄâÊã©
            const totalWeight = weights.reduce((a, b) => a + b, 0);
            let random = Math.random() * totalWeight;
            let selectedType = types[0];
            
            for (let i = 0; i < types.length; i++) {
                random -= weights[i];
                if (random <= 0) {
                    selectedType = types[i];
                    break;
                }
            }
            
            let question = {};
            
            switch(selectedType) {
                case 'addition':
                    question = generateAddition();
                    break;
                case 'subtraction':
                    question = generateSubtraction();
                    break;
                case 'multiplication':
                    question = generateMultiplication();
                    break;
                case 'division':
                    question = generateDivision();
                    break;
            }
            
            question.type = selectedType;
            return question;
        }
        
        // ÁîüÊàêÂä†Ê≥ïÈ¢ò
        function generateAddition() {
            let a, b;
            if (currentDifficulty === 'easy') {
                a = Math.floor(Math.random() * 50) + 1;
                b = Math.floor(Math.random() * 50) + 1;
            } else if (currentDifficulty === 'medium') {
                a = Math.floor(Math.random() * 500) + 100;
                b = Math.floor(Math.random() * 500) + 100;
            } else {
                a = Math.floor(Math.random() * 900) + 100;
                b = Math.floor(Math.random() * 900) + 100;
            }
            
            return {
                text: `${a} + ${b} = ?`,
                answer: a + b,
                display: `${a} + ${b}`
            };
        }
        
        // ÁîüÊàêÂáèÊ≥ïÈ¢ò
        function generateSubtraction() {
            let a, b;
            if (currentDifficulty === 'easy') {
                a = Math.floor(Math.random() * 50) + 10;
                b = Math.floor(Math.random() * a) + 1;
            } else if (currentDifficulty === 'medium') {
                a = Math.floor(Math.random() * 500) + 100;
                b = Math.floor(Math.random() * a) + 10;
            } else {
                a = Math.floor(Math.random() * 900) + 100;
                b = Math.floor(Math.random() * a) + 50;
            }
            
            return {
                text: `${a} - ${b} = ?`,
                answer: a - b,
                display: `${a} - ${b}`
            };
        }
        
        // ÁîüÊàê‰πòÊ≥ïÈ¢ò
        function generateMultiplication() {
            let a, b;
            if (currentDifficulty === 'easy') {
                a = Math.floor(Math.random() * 9) + 1;
                b = Math.floor(Math.random() * 9) + 1;
            } else if (currentDifficulty === 'medium') {
                a = Math.floor(Math.random() * 20) + 2;
                b = Math.floor(Math.random() * 9) + 2;
            } else {
                a = Math.floor(Math.random() * 50) + 10;
                b = Math.floor(Math.random() * 20) + 5;
            }
            
            return {
                text: `${a} √ó ${b} = ?`,
                answer: a * b,
                display: `${a} √ó ${b}`
            };
        }
        
        // ÁîüÊàêÈô§Ê≥ïÈ¢ò
        function generateDivision() {
            let a, b, result;
            if (currentDifficulty === 'easy') {
                b = Math.floor(Math.random() * 9) + 2;
                result = Math.floor(Math.random() * 9) + 1;
            } else if (currentDifficulty === 'medium') {
                b = Math.floor(Math.random() * 9) + 2;
                result = Math.floor(Math.random() * 20) + 5;
            } else {
                b = Math.floor(Math.random() * 20) + 5;
                result = Math.floor(Math.random() * 20) + 10;
            }
            
            a = b * result;
            
            return {
                text: `${a} √∑ ${b} = ?`,
                answer: result,
                display: `${a} √∑ ${b}`
            };
        }
        
        // Â§ÑÁêÜÊåâÈíÆÂä®‰Ωú
        function handleAction() {
            const btnText = document.getElementById('action-btn').textContent;
            if (!isAnswering) {
                if (btnText === '‰∏ã‰∏ÄÈ¢ò') {
                    // Â¶ÇÊûúÊòæÁ§∫‰∏ã‰∏ÄÈ¢òÔºåÁÇπÂáªÂêéÂºÄÂßãÊñ∞È¢òÁõÆ
                    startPractice();
                } else {
                    startPractice();
                }
            }
            // Á≠îÈ¢òËøáÁ®ã‰∏≠ÊåâÈíÆ‰∏çÂèØÁÇπÂáªÔºåÁî±Á®ãÂ∫èËá™Âä®Âà§Êñ≠
        }
        
        // ÂºÄÂßãÁªÉ‰π†
        function startPractice() {
            isAnswering = true;
            currentQuestion = generateQuestion();
            
            // Â¢ûÂä†ÁªÑÂÜÖËÆ°Êï∞
            currentGroupCount++;
            
            // ËÆ∞ÂΩïÈ¢òÁõÆÂºÄÂßãÊó∂Èó¥
            questionStartTime = Date.now();
            
            document.getElementById('question-text').textContent = currentQuestion.text;
            document.getElementById('answer-input').value = '';
            const actionBtn = document.getElementById('action-btn');
            actionBtn.textContent = `Á¨¨ ${currentGroupCount}/${GROUP_SIZE} È¢ò`;
            actionBtn.disabled = true;
            document.getElementById('question-card').className = 'question-card';
            document.getElementById('feedback').className = 'feedback';
            // ÈöêËóèÊï∞Â≠óÈîÆÁõòÔºå‰ΩøÁî®Á≥ªÁªüÈîÆÁõò
            document.getElementById('number-pad').style.display = 'none';
            
            // Ëá™Âä®ËÅöÁÑ¶ËæìÂÖ•Ê°ÜÔºåË∞ÉËµ∑Á≥ªÁªüÈîÆÁõò
            setTimeout(() => {
                document.getElementById('answer-input').focus();
            }, 100);
            
            const feedback = document.getElementById('feedback');
            feedback.classList.remove('show');
        }
        
        // ËæìÂÖ•Êï∞Â≠ó
        function inputNumber(num) {
            const input = document.getElementById('answer-input');
            if (input.value.length < 6) {
                input.value += num;
            }
        }
        
        // Ê∏ÖÈô§ËæìÂÖ•
        function clearInput() {
            document.getElementById('answer-input').value = '';
        }
        
        // Êèê‰∫§Á≠îÊ°à
        function submitAnswer() {
            if (!currentQuestion) return;
            
            const userAnswer = parseInt(document.getElementById('answer-input').value);
            if (isNaN(userAnswer)) {
                alert('ËØ∑ËæìÂÖ•Á≠îÊ°à');
                return;
            }
            
            const correctAnswer = currentQuestion.answer;
            const isCorrect = userAnswer === correctAnswer;
            
            // Êõ¥Êñ∞ËñÑÂº±ÁÇπÊï∞ÊçÆ
            weaknessData[currentQuestion.type].total++;
            if (!isCorrect) {
                weaknessData[currentQuestion.type].wrong++;
            }
            localStorage.setItem('mathWeakness', JSON.stringify(weaknessData));
            
            // Ê∑ªÂä†Âà∞ÂéÜÂè≤ËÆ∞ÂΩï
            const record = {
                question: currentQuestion.display,
                userAnswer: userAnswer,
                correctAnswer: correctAnswer,
                isCorrect: isCorrect,
                type: currentQuestion.type,
                timestamp: new Date().toISOString()
            };
            historyData.unshift(record);
            if (historyData.length > 100) {
                historyData = historyData.slice(0, 100);
            }
            localStorage.setItem('mathHistory', JSON.stringify(historyData));
            
            // ÊòæÁ§∫ÁªìÊûú
            const card = document.getElementById('question-card');
            const feedback = document.getElementById('feedback');
            
            if (isCorrect) {
                card.classList.add('correct');
                consecutiveCorrect++; // Â¢ûÂä†ËøûÁª≠Á≠îÂØπËÆ°Êï∞
                groupCorrectCount++; // Â¢ûÂä†ÁªÑÂÜÖÊ≠£Á°ÆËÆ°Êï∞
                
                // üéÆ ËÆ°ÁÆóÁßØÂàÜÂíåÁªèÈ™å
                const answerTime = (Date.now() - questionStartTime) / 1000; // Á≠îÈ¢òÊó∂Èó¥ÔºàÁßíÔºâ
                let points = 10; // Âü∫Á°ÄÂàÜ
                let expGain = 10; // Âü∫Á°ÄÁªèÈ™å
                
                // ÈÄüÂ∫¶Â•ñÂä±
                if (answerTime <= 3) {
                    points += 5;
                    expGain += 5;
                    checkAchievement('speed_demon');
                }
                
                // ËøûÂáªÂ•ñÂä±
                if (consecutiveCorrect >= 5) {
                    points += 10;
                    expGain += 10;
                }
                
                // ÈöæÂ∫¶Â•ñÂä±
                if (currentDifficulty === 'medium') {
                    points += 5;
                    expGain += 5;
                } else if (currentDifficulty === 'hard') {
                    points += 10;
                    expGain += 10;
                }
                
                // Êõ¥Êñ∞ÊÄªÂàÜ
                totalScore += points;
                localStorage.setItem('mathTotalScore', totalScore);
                
                // Êõ¥Êñ∞ÁªèÈ™åÂÄº
                currentExp += expGain;
                let levelUp = false;
                while (currentExp >= expToNextLevel) {
                    currentExp -= expToNextLevel;
                    currentLevel++;
                    expToNextLevel = currentLevel * 100;
                    levelUp = true;
                }
                localStorage.setItem('mathLevel', currentLevel);
                localStorage.setItem('mathExp', currentExp);
                
                // Ê£ÄÊü•ÊàêÂ∞±
                checkAchievement('first_correct');
                if (consecutiveCorrect >= 5) checkAchievement('streak_5');
                if (consecutiveCorrect >= 10) checkAchievement('streak_10');
                if (currentLevel >= 5) checkAchievement('level_5');
                if (currentLevel >= 10) checkAchievement('level_10');
                
                // Êí≠ÊîæÊ≠£Á°ÆÈü≥Êïà
                correctSound.currentTime = 0;
                correctSound.play().catch(e => console.log('Èü≥ÊïàÊí≠ÊîæÂ§±Ë¥•:', e));
                
                // ÊòæÁ§∫ÂæóÂàÜÂä®Áîª
                showScoreAnimation(points, expGain);
                
                // Ê£ÄÊü•ÊòØÂê¶‰∏âËøûÂáª
                if (consecutiveCorrect === 3) {
                    feedback.innerHTML = `üéâ <span class="bonus-text">‰∏âËøûÂáªÔºÅ+${points}ÂàÜ</span> üéâ`;
                    feedback.className = 'feedback success show bonus';
                    showBonusAnimation(); // ÊòæÁ§∫Â•ñÂä±Âä®Áîª
                } else {
                    feedback.innerHTML = `üéâ Ê≠£Á°ÆÔºÅ<span class="score-text">+${points}ÂàÜ</span>`;
                    feedback.className = 'feedback success show';
                }
                
                // Â¶ÇÊûúÂçáÁ∫ß‰∫ÜÔºåÊòæÁ§∫ÂçáÁ∫ßÂä®Áîª
                if (levelUp) {
                    setTimeout(() => {
                        showLevelUpAnimation(`Lv.${currentLevel}`);
                    }, 500);
                }
            } else {
                card.classList.add('wrong');
                consecutiveCorrect = 0; // Á≠îÈîôÈáçÁΩÆËÆ°Êï∞
                feedback.textContent = `‚ùå ÂõûÁ≠îÈîôËØØ„ÄÇÊ≠£Á°ÆÁ≠îÊ°àÊòØ ${correctAnswer}`;
                feedback.className = 'feedback error show';
            }
            
            updateStats();
            
            // Ê£ÄÊü•ÊòØÂê¶ÂÆåÊàê‰∏ÄÁªÑÔºà10ÈÅìÈ¢òÔºâ
            let btnText = '‰∏ã‰∏ÄÈ¢ò';
            if (currentGroupCount >= GROUP_SIZE) {
                // ËÆ°ÁÆóÁªÑÂÜÖÊ≠£Á°ÆÁéá
                const groupAccuracy = (groupCorrectCount / GROUP_SIZE) * 100;
                
                if (groupAccuracy === 100) {
                    // Ê≠£Á°ÆÁéá100%ÔºåËá™Âä®ÂçáÁ∫ßÈöæÂ∫¶
                    checkAchievement('group_perfect'); // Ëß£ÈîÅÂÖ®ÂØπÊàêÂ∞±
                    if (currentDifficulty === 'easy') {
                        currentDifficulty = 'medium';
                        btnText = 'üéâ ÂçáÁ∫ßÂà∞‰∏≠Á∫ßÔºÅ';
                        showLevelUpAnimation('‰∏≠Á∫ß');
                    } else if (currentDifficulty === 'medium') {
                        currentDifficulty = 'hard';
                        btnText = 'üéâ ÂçáÁ∫ßÂà∞Âõ∞ÈöæÔºÅ';
                        showLevelUpAnimation('Âõ∞Èöæ');
                    } else {
                        btnText = 'üéâ Â∑≤ÂÆåÊàêÂõ∞ÈöæÔºÅ';
                    }
                } else {
                    btnText = `ÁªÑÂÆåÊàêÔºÅÊ≠£Á°ÆÁéá ${groupAccuracy}%`;
                }
                
                // ÈáçÁΩÆÁªÑËÆ°Êï∞
                currentGroupCount = 0;
                groupCorrectCount = 0;
                
                // Êõ¥Êñ∞ÈöæÂ∫¶ÊåâÈíÆÊòæÁ§∫
                updateDifficultyButtons();
            }
            
            const actionBtn = document.getElementById('action-btn');
            actionBtn.textContent = btnText;
            actionBtn.disabled = false;
            isAnswering = false;
        }
        
        // Êõ¥Êñ∞ÁªüËÆ°
        function updateStats() {
            const total = historyData.length;
            const correct = historyData.filter(h => h.isCorrect).length;
            const wrong = total - correct;
            const accuracy = total > 0 ? Math.round((correct / total) * 100) : 0;
            
            document.getElementById('total-count').textContent = total;
            document.getElementById('correct-count').textContent = correct;
            document.getElementById('wrong-count').textContent = wrong;
            document.getElementById('accuracy').textContent = accuracy + '%';
            
            // üéÆ Êõ¥Êñ∞Ê∏∏ÊàèÂåñUI
            updateGameStats();
        }
        
        // üéÆ Êõ¥Êñ∞Ê∏∏ÊàèÂåñÁªüËÆ°
        function updateGameStats() {
            // Êõ¥Êñ∞Á≠âÁ∫ßÂíåÁß∞Âè∑
            document.getElementById('level-badge').textContent = `Lv.${currentLevel}`;
            const currentTitle = getCurrentTitle();
            const titleBadge = document.getElementById('title-badge');
            titleBadge.textContent = currentTitle.title;
            titleBadge.style.background = currentTitle.color;
            
            // Êõ¥Êñ∞ÂàÜÊï∞
            document.getElementById('total-score').textContent = totalScore;
            
            // Êõ¥Êñ∞ÁªèÈ™åÊù°
            const expPercent = (currentExp / expToNextLevel) * 100;
            document.getElementById('exp-fill').style.width = `${expPercent}%`;
            document.getElementById('exp-text').textContent = `${currentExp}/${expToNextLevel}`;
        }
        
        // Ê∏≤ÊüìÂéÜÂè≤ËÆ∞ÂΩï
        function renderHistory() {
            const total = historyData.length;
            const correct = historyData.filter(h => h.isCorrect).length;
            const wrong = total - correct;
            const accuracy = total > 0 ? Math.round((correct / total) * 100) : 0;
            
            document.getElementById('history-total').textContent = total;
            document.getElementById('history-correct').textContent = correct;
            document.getElementById('history-wrong').textContent = wrong;
            document.getElementById('history-accuracy').textContent = accuracy + '%';
            
            const list = document.getElementById('history-list');
            
            if (historyData.length === 0) {
                list.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìã</div>
                        <div class="empty-state-text">ÊöÇÊó†ÁªÉ‰π†ËÆ∞ÂΩï</div>
                    </div>
                `;
                return;
            }
            
            list.innerHTML = historyData.slice(0, 50).map(record => {
                const time = new Date(record.timestamp);
                const timeStr = `${time.getMonth() + 1}/${time.getDate()} ${time.getHours()}:${String(time.getMinutes()).padStart(2, '0')}`;
                
                return `
                    <div class="history-item">
                        <div class="history-question">${record.question}</div>
                        <div class="history-result">
                            <div class="history-answer">‰Ω†: ${record.userAnswer} | Á≠îÊ°à: ${record.correctAnswer}</div>
                            <span class="history-status ${record.isCorrect ? 'correct' : 'wrong'}">
                                ${record.isCorrect ? '‚úì Ê≠£Á°Æ' : '‚úó ÈîôËØØ'}
                            </span>
                            <div class="history-time">${timeStr}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // Ê∏≤ÊüìËñÑÂº±ÁÇπÂàÜÊûê
        function renderWeakness() {
            const chart = document.getElementById('weakness-chart');
            const tipsCard = document.getElementById('tips-card');
            const tipsList = document.getElementById('tips-list');
            
            const typeNames = {
                addition: 'Âä†Ê≥ï',
                subtraction: 'ÂáèÊ≥ï',
                multiplication: '‰πòÊ≥ï',
                division: 'Èô§Ê≥ï'
            };
            
            const typesWithData = Object.keys(weaknessData).filter(type => 
                type !== 'mixed' && weaknessData[type].total > 0
            );
            
            if (typesWithData.length === 0) {
                chart.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìä</div>
                        <div class="empty-state-text">ÊöÇÊó†Ë∂≥Â§üÊï∞ÊçÆËøõË°åÂàÜÊûê<br>ËØ∑ÂÖàÂÆåÊàê‰∏Ä‰∫õÁªÉ‰π†</div>
                    </div>
                `;
                tipsCard.style.display = 'none';
                return;
            }
            
            const weaknessStats = typesWithData.map(type => {
                const data = weaknessData[type];
                const errorRate = data.total > 0 ? (data.wrong / data.total) : 0;
                return { type, ...data, errorRate };
            }).sort((a, b) => b.errorRate - a.errorRate);
            
            const maxErrorRate = Math.max(...weaknessStats.map(s => s.errorRate));
            
            chart.innerHTML = weaknessStats.map(stat => {
                const percentage = maxErrorRate > 0 ? (stat.errorRate / maxErrorRate) * 100 : 0;
                let level = 'low';
                if (stat.errorRate > 0.5) level = 'high';
                else if (stat.errorRate > 0.3) level = 'medium';
                
                return `
                    <div class="weakness-item">
                        <div class="weakness-label">${typeNames[stat.type]}</div>
                        <div class="weakness-bar">
                            <div class="weakness-fill ${level}" style="width: ${percentage}%"></div>
                        </div>
                        <div class="weakness-value">${(stat.errorRate * 100).toFixed(0)}%</div>
                    </div>
                `;
            }).join('');
            
            const tips = [];
            weaknessStats.forEach(stat => {
                if (stat.errorRate > 0.3) {
                    switch(stat.type) {
                        case 'addition':
                            tips.push('Âä†Ê≥ïÈúÄË¶ÅÂ§öÁªÉ‰π†Ëøõ‰ΩçËÆ°ÁÆó');
                            break;
                        case 'subtraction':
                            tips.push('ÂáèÊ≥ïÈúÄË¶ÅÂ§öÁªÉ‰π†ÈÄÄ‰ΩçËÆ°ÁÆó');
                            break;
                        case 'multiplication':
                            tips.push('Âª∫ËÆÆÁÜüËÉå‰πòÊ≥ïÂè£ËØÄË°®');
                            break;
                        case 'division':
                            tips.push('Èô§Ê≥ïÈúÄË¶ÅÁêÜËß£‰πòÊ≥ïÈÄÜËøêÁÆó');
                            break;
                    }
                }
            });
            
            if (tips.length > 0) {
                tipsList.innerHTML = tips.map(tip => `<li>${tip}</li>`).join('');
                tipsCard.style.display = 'block';
            } else {
                tipsList.innerHTML = '<li>üéâ Ë°®Áé∞‰∏çÈîôÔºÅÁªßÁª≠‰øùÊåÅÔºÅ</li>';
                tipsCard.style.display = 'block';
            }
        }
        
        // ÊòæÁ§∫‰∏âËøûÂáªÂ•ñÂä±Âä®Áîª
        function showBonusAnimation() {
            // ÂàõÂª∫ÊòüÊòüÂÖÉÁ¥†
            const star = document.createElement('div');
            star.className = 'star-animation';
            star.innerHTML = '‚≠ê‚≠ê‚≠ê';
            document.body.appendChild(star);
            
            // 1ÁßíÂêéÁßªÈô§
            setTimeout(() => {
                star.remove();
            }, 1000);
        }
        
        // ÊòæÁ§∫ÂçáÁ∫ßÂä®Áîª
        function showLevelUpAnimation(levelName) {
            // ÂàõÂª∫ÂçáÁ∫ßÊèêÁ§∫ÂÖÉÁ¥†
            const levelUp = document.createElement('div');
            levelUp.className = 'level-up-animation';
            levelUp.innerHTML = `üéä ÂçáÁ∫ßÂà∞${levelName}ÈöæÂ∫¶ÔºÅüéä`;
            document.body.appendChild(levelUp);
            
            // Êí≠ÊîæÂçáÁ∫ßÈü≥ÊïàÔºà‰ΩøÁî®Êõ¥Ê¨¢Âø´ÁöÑÈü≥ÊïàÔºâ
            const levelUpSound = new Audio('https://assets.mixkit.co/active_storage/sfx/1435/1435-preview.mp3');
            levelUpSound.volume = 0.6;
            levelUpSound.play().catch(e => console.log('ÂçáÁ∫ßÈü≥ÊïàÊí≠ÊîæÂ§±Ë¥•:', e));
            
            // 2ÁßíÂêéÁßªÈô§
            setTimeout(() => {
                levelUp.remove();
            }, 2000);
        }
        
        // Êõ¥Êñ∞ÈöæÂ∫¶ÊåâÈíÆÊòæÁ§∫
        function updateDifficultyButtons() {
            const buttons = document.querySelectorAll('.difficulty-btn');
            buttons.forEach(btn => {
                btn.classList.remove('active');
                if (btn.textContent === 'ÁÆÄÂçï' && currentDifficulty === 'easy') {
                    btn.classList.add('active');
                } else if (btn.textContent === '‰∏≠Á≠â' && currentDifficulty === 'medium') {
                    btn.classList.add('active');
                } else if (btn.textContent === 'Âõ∞Èöæ' && currentDifficulty === 'hard') {
                    btn.classList.add('active');
                }
            });
        }
        
        // üèÜ Ê£ÄÊü•ÊàêÂ∞±
        function checkAchievement(key) {
            if (achievements[key] && !achievements[key].unlocked) {
                achievements[key].unlocked = true;
                localStorage.setItem('mathAchievements', JSON.stringify(achievements));
                showAchievementUnlock(achievements[key]);
            }
        }
        
        // üéâ ÊòæÁ§∫ÊàêÂ∞±Ëß£ÈîÅÂä®Áîª
        function showAchievementUnlock(achievement) {
            const achievementDiv = document.createElement('div');
            achievementDiv.className = 'achievement-unlock';
            achievementDiv.innerHTML = `
                <div class="achievement-icon">üèÜ</div>
                <div class="achievement-text">
                    <div class="achievement-title">Ëß£ÈîÅÊàêÂ∞±ÔºÅ</div>
                    <div class="achievement-name">${achievement.name}</div>
                    <div class="achievement-desc">${achievement.desc}</div>
                </div>
            `;
            document.body.appendChild(achievementDiv);
            
            // Êí≠ÊîæÊàêÂ∞±Èü≥Êïà
            const achievementSound = new Audio('https://assets.mixkit.co/active_storage/sfx/1435/1435-preview.mp3');
            achievementSound.volume = 0.5;
            achievementSound.play().catch(e => console.log('ÊàêÂ∞±Èü≥ÊïàÊí≠ÊîæÂ§±Ë¥•:', e));
            
            setTimeout(() => {
                achievementDiv.remove();
            }, 3000);
        }
        
        // üíØ ÊòæÁ§∫ÂæóÂàÜÂä®Áîª
        function showScoreAnimation(points, exp) {
            const scoreDiv = document.createElement('div');
            scoreDiv.className = 'score-popup';
            scoreDiv.innerHTML = `+${points}ÂàÜ`;
            document.body.appendChild(scoreDiv);
            
            setTimeout(() => {
                scoreDiv.remove();
            }, 1000);
        }
        
        // üéÆ Ëé∑ÂèñÂΩìÂâçÁß∞Âè∑
        function getCurrentTitle() {
            let title = titles[0];
            for (let i = titles.length - 1; i >= 0; i--) {
                if (currentLevel >= titles[i].level) {
                    title = titles[i];
                    break;
                }
            }
            return title;
        }
        
        // Ê∏ÖÁ©∫ÂéÜÂè≤
        function clearHistory() {
            if (confirm('Á°ÆÂÆöË¶ÅÊ∏ÖÁ©∫ÊâÄÊúâÂéÜÂè≤ËÆ∞ÂΩïÂêóÔºü')) {
                historyData = [];
                weaknessData = {
                    addition: { total: 0, wrong: 0 },
                    subtraction: { total: 0, wrong: 0 },
                    multiplication: { total: 0, wrong: 0 },
                    division: { total: 0, wrong: 0 },
                    mixed: { total: 0, wrong: 0 }
                };
                localStorage.removeItem('mathHistory');
                localStorage.removeItem('mathWeakness');
                updateStats();
                renderHistory();
                renderWeakness();
            }
        }
        
        // ÊòæÁ§∫ÂàÜ‰∫´ÂºïÂØº
        function showShareGuide() {
            document.getElementById('share-guide').classList.add('show');
        }
        
        // ÈöêËóèÂàÜ‰∫´ÂºïÂØº
        function hideShareGuide() {
            document.getElementById('share-guide').classList.remove('show');
        }
        
        // ÈîÆÁõòÊîØÊåÅÔºà‰ªÖPCÁ´ØÔºâ
        document.addEventListener('keydown', function(e) {
            if (!isAnswering) return;
            
            // Ê£ÄÊµãÊòØÂê¶‰∏∫ÁßªÂä®ËÆæÂ§áÔºåÂ¶ÇÊûúÊòØÂàô‰∏çÂ§ÑÁêÜÈîÆÁõò‰∫ã‰ª∂ÔºàÈÅøÂÖçÈáçÂ§çËæìÂÖ•Ôºâ
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            if (isMobile) return;
            
            if (e.key >= '0' && e.key <= '9') {
                inputNumber(e.key);
            } else if (e.key === 'Enter') {
                submitAnswer();
            } else if (e.key === 'Backspace') {
                const input = document.getElementById('answer-input');
                input.value = input.value.slice(0, -1);
            } else if (e.key === 'Escape') {
                clearInput();
            }
        });
        
        // Èò≤Ê≠¢È°µÈù¢ÊªöÂä®ÂõûÂºπÔºàiOSÔºâ
        document.body.addEventListener('touchmove', function(e) {
            if (e.target.closest('.history-list')) {
                return;
            }
            e.preventDefault();
        }, { passive: false });
        
        // GitHub Pages ÈîôËØØÈ°µÈù¢ÈáçÂÆöÂêë
        if (isGitHubPages && window.location.pathname !== '/math-practice/' && 
            window.location.pathname.indexOf('/math-practice/') !== 0) {
            // Â∑≤ÁªèÊòØÊ≠£Á°ÆË∑ØÂæÑÔºå‰∏çÂÅöÂ§ÑÁêÜ
        }
    </script>
</body>
</html>